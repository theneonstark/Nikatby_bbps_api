<?php

namespace App\Http\Controllers\BBPS;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Helpers\CJS;
use App\Models\BbpsServices;
use Carbon\Carbon;
use Twilio\Rest\Client;
use Inertia\Inertia;
use Illuminate\Support\Facades\Http;

class BbpsController extends Controller
{
    protected $accessCode = 'AVQU51SS09TR19KLWN';
    public function services(){
        $services = BbpsServices::all()
        ->groupBy('blr_category_name')
        ->keys()
        ->toArray();
        return Inertia::render('Billpay', [
            'services' => $services
        ]);
    }

    public function getAllOperator($category) {
        $decodedCategory = urldecode($category);
        \Log::info('Decoded category: ' . $decodedCategory);
        $services = BbpsServices::where('blr_category_name', $decodedCategory)->get();
        return Inertia::render('CategoryDetail', [
            'category' => $decodedCategory,
            'services' => $services,
        ]);
    }
    
    
    
    // , $biller, $type
    public function billerId(Request $request, $biller)
    {
        $billerNameId = BbpsServices::where('blr_name', $biller)->first();
        try{
            $requestId = \MyHelper::generateRequestId();
            $key = '2940CB60C489CEA1AD49AC96BBDC6310'; //for live bps
            // $key = '48ECC74C29EB85471E7511C54C0F310A';
            $xml = '<?xml version="1.0" encoding="UTF-8"?><billerInfoRequest><billerId>'.$billerNameId->blr_id.'</billerId></billerInfoRequest>';
            $billerId = \CJS::encrypt($xml, $key);
            $url = "https://api.billavenue.com/billpay/extMdmCntrl/mdmRequestNew/xml?accessCode=AVQU51SS09TR19KLWN&requestId=".$requestId."&ver=1.0&instituteId=RP16";
            $header = array(
                'Content-Type: text/plain'
            );
            
             $res = \MyHelper::curl($url, 'POST', $billerId, $header);
            
            // dd($res);
            //Electric North bihar
            // $res['response'] = 'd1b28012646941dd58185ec704a94818f1f123087515238003ee252a8aebd06b5d6b6dfb06cc2f2a02ee374a23a1764cfd09c9245e058d5d6c2de423365e016cd21d8566ad7c7ee72511cb4aa680f125a12a8e93113daba0212966bce35698db217cac0fb8a8587251d05f9ff64f285ed35fedb93311538583018d93cfa236edc28708658af426e29ec0e18301fc0729dca55b57940f24cdec13e3f4b7d132cbf78c3a47755e883289f0a98cb85a022b4b12c6023e97c9750e3bcbea1ebc49a7731aa239b5a139cf6f3f72b211d89b13ea2180f5e17e81fd91bea8120adbd88703d774c59b377204153295052571760324a67f30e9ddb50a8032df8e90ecb550d6da0328abc042fb270b0507cd85b9ac0d687bfbb6d78fdad2ed4353bec13e58c9588311ea024a47ce59b5c97a84a657bc279920dfa57789e0fe1f0f02959453d08baafeff000681ec81c5bc1891970c8a193c2f79049d7b49c58dfa7951164feb0e0d2d85c33d35e140be29413d3ba8f2ca48c0db817ee81519ebe8ad9d73748ce54d404514a3462d76cf30cb400ea10d926216669bb3dbf101aa33642fa4b8f7749a009b92c1bb6a736fa4d8979c1630007a33c7868096d790d21bce75e4326d41f124bca798a4e8b048a22569c2184477f250970be4dca4d29287566be4ac8a8bb86b753e5356d3365d779e2970248696993719491864335459e1c0c7c0c715adc61645fb7738b01819566b32f16b3e2d98cbfcdc9d7c0d56c819383dd14419c75f8f3284f8f5e92811566c13fcaf4de318f2ebd852e83c39126cb332d2213cfbe556027c71865232f26339b299a903a09ae948ed4bed8c940c8147a80c0e4b026cb1e5ea193e3618c3cac78a8af37a948f9540a21bf532a4424447dfe8ed5e73c6b8c3b33315022a951c463051e4781277f61c8129aab0cd849d67c197926aed307bff663db6137dbcb42a57dc155a2180ead7f37422c01a1b49f645c42ba069c5950042dec9289afaba894415fbb6d318a1cf4be9cb4ed2c87d5cf479d9e40a81ee8fe07ffdce739c365727d455cac553c60fa38af69b474584ae6994761b17be741f23998ed6c9f7d8955581f1e049f3d95ef312a16d87fe565c573aed879d5a67dbb1bc136930a6e3ee68a05603ba7422a490ed809586336dd763db2578fa9da6a50d86f104b325429f0134dae8e2bf84e2528733da5aecc3e5ac5b4f1f82e2e42c496a2d810c5ae0ecf13049c0ae8a900557d91b86a0b93ea10f112fb3aa41ed4de81ead919b06c5115db862f534762f245592a2d7cf6b0d57bf38c1a874fc780f30824669071cc2fb113221935ab20ce0dfd814292109b904399ffa5b90a37bc22dec8e5f78913a7023551af0494512090a6cbb8df38fb644027c64dc44275fec6ceae681b1daf0a29003a14ab0c7643355ebf2f164c3f644cd126f489edc204c599ae09b24e0ea186811b4fe8ad9bd5b75d6f0dd12649437c9613ad9d2ff463d43e812f5996d7858cc3473baab1bf76142f7f53bfbba56fcbd303e204d24773c26dfa29fd3e129924556478adc0a78c23f433814aab304fd7b09201abf8ad5203a4ffb3d93c48c97f42c447c100bde26f668a14ef96fc146e9cebe77c5eea16996a99d6dd22584cdb65f3170c4fbe57213495a8560f145096bd88be4d0a8325b027332015718f54630c43caa9ddf230f9d5e2f005f36128b4258c93dc779bb75854a5aba0e5eea07f73ac58d96a1775ad20a483b2f3a4b8cb7d67a3c525c5946fab72da2c6d12ce8745178badce509f92ae09b5f0acf0087b033ecebc8d04ba788870f0cdb68f95747b8c3ef707cad9952375604e0b6b7c2b054d874d6bb1b7bac62f7695c01b8a00d5a20a226d8cccfad32baeaf28214e33cf3e15b018bc91158ad132a3aa64113bead4e9e86d554198f723e845505e13b98e3fed319bfa99c688ea3804dd89c8da7df4751c1326244a2719200717eae38115044d4778c6ed99e5340962a686e4fa7fe9b7934ce0ad949584c4f64cb4e235cab0ec50fbed5fec9a56e83c84df581db4bc43b629d5fab8a0665ef3235a0cdfe0882baab28ad7b315ef0420bb9b627c00da25b661556e20808abdc6dd0720293150f267fa1e67926848457c23e50ba9f6d54757c9b061cbc54a72333d2c79693d88ec34139b3d92a14f49114a587938be0dd04a2afe42c91984e49a6f57fab082c88f0fd5e7a74d2e2436bc02e0a4354ccddaa99097a66518143ab7d34ccb19aad4257dfbb355a9999d5babf9b330f965a611c7715d834d77f8284ba207548a4552e66f58777f44fcc6582c934f9b9bb198ea8fe1fab6c98198498067c161a77efbdb2e1fe243c887050e443c4bd6c6b41e6beaf6b945592433d2465e29157c49e8bc2f583bb8110cffa3ec0ec764ccbb6ce6a671f7c020ac5ae807b45b2a86cb1f66b682b86d4310e26ed514f935747c76e14c9c7fe9fa05d79aeab227ebce34567b964049ba6962f9c5727ee70010b23c5b775b817c55fd2e7754157c18627e39dcd5997989fe1807b7836893bceb4a81431d34d010b1211da59229d3d307bb3ce4c35634ba385cd24fc7378a42120d71e1d0e6553efc99eb72f2972b58a1a6bd16a60098263aacb813eb878921255466f2ec784080c141fb1526fd101fa7c31ba2f88ea38c226e3ef4cc8d25764c7dfcfe9d3db64bdd268e8744c0c44c9d066f55172d5963cecf0b2d402381a7845ac2013d8ead6a81daa52254d6226e28455e139998e689bc96239ad3e2460acf9cec9527058a2115ab6aef626e46a60022061f225d7368aa621f19be8ae9f1ff27b91c8d5f23558fbfbfadc7a4e9b77d457e6145a79c48e5ae873bb289bb7674f447ff6f49d98691ffdd5ab969fb8cdba670d9fe54a0a59e21d721f835fce5510b345fa013f91742808674057818f6c69860ec77bf58986d3295b792e3941f74256c811ccc2ba958941ee236251e4c1f8deefeed92350a55c396632589feff6a2b03d0b88c49982d685e7734b1acb0d4da2462645d4dae0bd97c17011b78c74660a8cb7137eadb9c226dfe6a01351ee43fa64415b083ada9d230acb9261aa2311a0c5fbd230a32d09539b92ac5d9b31de5135434f31cb97d4abe209703938a5c3f86946b6d0502c2a79d4e97bb793c1f1e8d3d4202717299f351345eee15c2a428ba6e62193c63601f8934eb7dbd9b797f75d2be871508aa21ac9281d7e7653132baf640d6a7f81f7bcb12c3dc54c3d30a8e0eefd84e6e315b5181292ba5374c6b2af106e5ddc7735704915e86218c12f0db524e31019bf1e7f034cc5dcc5e16a7db8d8f153e42505d871ad1557248c5bd6818ee2e5e5a80c9e7a1c9b469056855e87831d6a553181064507b28e6ff2db8f34e80aae1ad134d11f4a5e9def01787195fc52b2be3a11d7519343653ee61eaef769511f12feead5caa67b7ee9764b8a86ac2a55a1b76343c55a84715ce8d00073e20878d4d30af75c14b5050a42147d4ad218605b5d17f413727de070027ad81f7510413880f36a647d2ae3095a0bb6b092a19e746af80e280907e196bb03deb442eebd78c361dbee8e94eed78a0d4d54c721fe2b136580b9970ca4f3176a5f835adfe335271ee7406757862344ebb75d42d76eb71496e9fdefcf74790543a10ef2cdae8f9d814e19794eddad43d4887a8d2739848a20c9d9dfa2f1d78babef0355c138f782c99418ed34324067ffeb477493b7b401384e8242acff110fca1b7537cb3419196dd5cba8bd04edcaedf3fd72ded2a0a75f34ce981ab23f03e3f8f312f884a2fdb882f1b917e0cff2ab17c5f31f2da9dd519350f317f842f2a8ed16bcf44001438acdcbaf7db6f017f47c18335871726c82e4839567301d086e336b5495832bc8dc5711f71d09daeb71633c52aaad47e2d4db0d7c1cc458fe588d87c52eab4bf99fedc4d6c35a215f02406c230dc49663148804847b3f0afe7ec1ce3761e4d8af21fcd829c5d84ec06b4685df3782a58d950b5ee84ce5fb94148f4ec55978f9caa2aea61053e5588794a247a530e0c3e2b07af15cf4ec3808b0213f7f8d328d032de7e38bb9f94cbe48f70decf738a29df7fa8fa03382f564a81002345e054ca7a1a1f28a446141c75995d9e108725901c3eb2375c23fd1a06d8e2f8bb49aa151cd0853f68169396eb0ae2cb81dfc606c6d1f39a65fd6ef560caf172ab07f5516e9d8fa21086e3ddb96eb2ac98e995ad81bd7250ab99afc4711b945e9dfe85c124cee76c84c73e4edb2953c604a900f4cbbfc35c5aa84dddf53e86f38d4532e90cbece0322b2d224076ca869728b81891c82685ea15afc1f3cf32096b899835fa805c0cf2eae686f91902667da645287d3d6e50f0f7ad40157badb7e6f1ac21658b413e21bed8a7dbc15e04667fa02292d1fe328bd7d05179c570a7a0ac71d798d93ca6f862b4791ae1e6203a2b270c80eb538a5833846dbfcf35923d582b2e393e1e82df86de11b81c56adfc6319d40a794cfcef18b6b244c234e6af6a32b53f85e64c520a601fe71f5d1c1816824256e6a53a7d69feb98bb6dfff68fc776dae667aab12b582452f03e365ed73e7c6c13cf5692c6f57c44341da6c2abf379b708c4df3a1f58e26ddacabac53b8c8ef397a87b66fe38356da9cfb8e34e6cdeebf667e37c9eb475e83f118181e9c1b2fa93abaa5f1fd7d88b61b06a5f0b3f74300fa29a0e8ff7ee9e4f3a1d811d4b1a4f7f297f07c0c1df57be44d97e1b2e757491d60a9070bbb7f0970544019db5b9c5ef31ba680238ffbc935a934c1c7b9d653c138088b147b58cce93f996748ffed676da8c5268bde025406c78ab318cd2c8d31cb673ceb46652d1b3702eca1050dd86c3acf4291313e0e6bde2706f0e8f81f14488a8736751f133da4abe94ae41f8c2fc85c803edaab356e56920e4f22f885f8e6879109e59f6e5e145d5d75876a1ea96f6beb035bce2e4cf6abaef33423584b6a78749fae253f6c5369eadbe37abf4987741072038ad375ef5445e35758ad7858a05b440a9a9dbbbd5a4d38c0f7a319dd23274e48d541c05836a4d33e02fe99b6019ef7a1ade76d257f2a56416ab91f1edb60221b510ef3aedeb6c52f017a920400199ab094df2ea69a0d8c15b3bca0625dc100310cd9565f0bdf19ec875041762e046eb2f13ec728afa90a1bdc14821e8c2c87157958bd0898505154e5096d27976143de61b8827d4856ebaf3c1a4c9b347452913dd6a271c2dc433f8b29cce495dc62a207e747db608e4a92ab7fb24912dc9fdb85dea3a3c198331d201ae088589387c1c5b2a787572eb1e7222fde1ad2f069297c3be561ad660e0eb31eb793c065cc0fda0b4409907c9c9a35160b96fc24ca7cdcee82a25bad085f4410212600cddd31551bca1a0a13b47ce419177e04c6c66e18991cb8f3b5ab8b1caaa193a557ea2eeb334cdc943c950d85171b63c6e3d21b8512b7e38b3ed22ea1c9e750dd5a1125c07bed3898415ee8f8331ec1313db104fd2b5f7966d73d407358893f224e1c2eca08255e8f55f53991221bd8e46632d82f94ba280500239de694830bb8121398c1dd91add38adb9bfaf5522dd637e17d1b19d931c0f4d106fdba9a119e639f4249ddfa6301251e9d3584e612023bf45701915d982c9de970e794a4fc90057f7df636e75f1cac420c9d9a209bdadf2a15f70d100e600250d77dc495f2330494e2d70f318cf853140fbeae72427f5cf98459986381d21bc5080e2dc43f007af71ff16ccc68e1a137acd3d906c7198c3c1a80c9db3f860d71774980700f9044464a6dcc15419cac88803acd552b30f8543db3fd01d7d337e87d89906041173b33bcea1d3dda82b85f3400f579121728365a83b5194effed2e1cbf19164c664b2258d4ae107ca2ebea015f31b4356ded7d8cc219d2d2d9143da7fc3e2dc05689a1c1881f532dff86c69d9ead996c718827de273b9c884a9edbc09b6ba9246b583bc920bcbb4da12acfcbedc7406cab7c417a34492db71b1153137db68c4be55db5b695fa337bd04f685c1b873532e6c47aa23146d919766674ed1c45ea2736c2eb40469c59973b8e928118265739473c0c26734f3ea3540e4e6617214aba21880274fd28c158b72a58c21bdb4064f23d57f9ee362293bdb091c079cf8547fd68d2d28c5f21756e405ee94f44efa752f88963fab2b2a76ec49e0cb95ac8ab2c7a06201ba31b875bd619800e78aa517b543fe909e9dd4793c149af75c7a794431e15c08d221e6396c2839e6f3fcd9010cf78256aa5ef896c8e1c4e67192f89417a74e3de7849093c3b31d486956e2d13c0bf448f8cad8500d15f27e7a0e9c3f0ef8575fe14a530e43a8c6b8ad4eeb76b8f3ef7fc7b52bd9814fb2dce3ff76833e31cfdb5936497fc098f6179c742de0dd872ef559d028cd8d72669f99b410afb9c56d6ca8b4a72b54fd7273434717476dc5506480391ee1ef7f4b9803bb129a2e2510abeea05f1821e0a7652a55d6b907fc876c988f44eae22cec2fc587f7a2d94263e6578666a8b6d9b5c622c91195c95acd1afa0d67ba3b62276f67c43836af1b34921fb508c7f2ee1bd76b6b0081dcdc5faf4da96bcf8e09393262795702e0883845e1c77ccd87ffd51d8acc8a3ede79e2d6ff8b1c9b5b3d4463cda2f393d2f3a824a8cc7bac1c710869b04b35677015a3996d6eea87f38c75fbb5b6cb3a0381598ea1ca0030ca6656020f0e4b84398c88677de920da48f7a366bb97f7f90a63a04dcde00a479fb3736238862d95550e403ddd95364e6f1cff4305d8bfd790933ed98e8653821c8fa53042941469071d0f42d3a2ff09b882efb3e21d09576d7da41a622829585d2082177f2ded15bd0f5b014f3b2abca2cc52945e5862a7c43c54cfd16a5bd3f20d5ab1063963b144031810e66201cec96711125c145f517218e1bc2352fb5961bac637c42a0953208cc4d40c031ed4d6f40379bcc6cf3be003ad3dbcae37f20ef064793a3952aed2f67d1031c09c649061332520abd583bb2b3b8121c4a5c8a07da9d8d4986f122c1af984ab0b57fb9da31036bd0b8df87cf8068b4112f8bc6beeb8ae51d9a932d0217765172d22329edf273014b853631bbf82360a13ce62b33e4b53236d17f0afabd6d4d412e84064bba4b1947658d48eae41ea032f8afa843f5a4297cc27501aa9181118d01183c47201bb02b14a65dd695d783c9c60c4da0919d28903852e3d4c14b13b1decc7ffe637bbe04bbc8f44c93cb674a1a2fb5b4a258a28ce52d94a169f542175e80a7f219dab41546e33abd38b70dd33a05e06ef7a21eaa67ce9c522d7f35d52fb222d596364c803dc21b20b7072536ef5ecadc38835b5ee8325b5af9070b4f9beee3932afd25b6e6f8361b119b4d7f2064983797f2fe7c9c1c5aaa30f49520e567af9ca8f66b03d5e3bbb237417e76180d2298c9a8ada653f57cc3fdfda86813b58daca983b3626c0cfbee1d673917f07ba6e5b9dc0f06258ca711c245e8397a9b084c6b9c45bc599d13259bd54016cc84e35d0eb79c9727b2ad0ca8bb3b01f48dc1d90701853309146267d21b89f8398c54';
            // Kotak Loans
            // $res['response'] = 'd1b28012646941dd58185ec704a94818f1f123087515238003ee252a8aebd06b5d6b6dfb06cc2f2a02ee374a23a1764cfd09c9245e058d5d6c2de423365e016cd21d8566ad7c7ee72511cb4aa680f125a12a8e93113daba0212966bce35698db217cac0fb8a8587251d05f9ff64f285ed35fedb93311538583018d93cfa236edc28708658af426e29ec0e18301fc0729fd8503e085f271d9cba39661fa10cf67b2d985ca5c3d29a868a7f16cd941f3f8130e7e3ba03c5168fd919ce4163a2022c299b994b2c86433f672d87a55085508fcbfb338614bd5218addf28790e05ddbe5efd01c4329339614e9b41130cf16b00aed47325c38e78c0526e713e6bfedf49e051b63130e20d4e32725a555e3b866229787b5a739a6bb645a18dab126a04eb6246408aaa01c681a2b2093a4c0d7eb9450d87e642d1f10211f734127a976b7ece302f254d6b1f8b919fd2ccdb9f7a791cca7acdb9da3d2dd86d77f95794dd2323b4b922869ffc9b8971b50bb66e88ab5a5b4843eb827756cd91110a091aed56c80e671684fc16eacd5bc00fffef5bb3334ed57dfd44523a4993f3b4d750f9387d24a756b7d6dd4c10e659a5fd8c7c0eadacb1eb9ae448ea0e868582eb96dd9c7ad2afad83ffc434fb406569aa956a7fa593275d8613e2e348331f7400ccae2ae73aae9a0e50f40c704b44d22af12ec1129723be9fc85066895b0bcd549e39a446bb22b6e7a354c9cc52f8345b88c040b401d3d15eb0b7da78925bfb61032db934f4e5a105bf18045646532b4113a6cd75ed6f46e7fb22326a697072a8b27ed75808471d800f1a428a1f1b1dc5ee135969570ec25ace4e0fe4f5078347561d7155282f4f1af5d7c2dc697ad574f878ad27b5e503893fa60561bd4d148d6e4828412fe147dd44e39853e36ab1f0d6db5cbaafb0d430238f0f29fb073a7b83947ea1c9accc282e00210e2c0f458af00566c514384398493c4078ad91028b95475bb1abfe5a4c943500cebb02ee0ef6e776a9e21f7bab40d0eadce762336e94b58b16f583d5369daf468a70a4a4c8c543f36db1b1f1e29c5b293d27d4733a47553d337ed046043ee0038962bce2f87a14d946baaa006ed4562cff0df6d31554f00514312f6dbc8774b8f12803ff54b948a2404a935859ec1cc02d7e9fd56c294ca1fbfb7086b8317a1a3b30c94fa27561d7fab2c306b5800e22220d65f6cb4c0ee9d7c50205cc71fc03efee22491698685920cf7145c50fd12e7ae356d9c0ab0709f721e23cbf111a8feceaac39d7ede7acf3e2a47bf891ed242abee3304be6f913666196cb6e0446d1318155d8f227e539f344a22cf766b9e049965a4e6dfdc35f1ed715a42d661b52212506e7aca3a30c6367a3cf2377dcdf2e9990df70805f892fe4d09ce766cc1f785f81e2576715571a5ecbc76269cccfd17d21e5a40eb576a6fb1581236e7e06be8c6e045c0720b5a68b3371966eb9873f97fb2429e3e1541900a4337bbd8eb00c6e1d08e85f8d73e39e8be10a84b17b181c54a5a9acfa1744c0f6f0a3d2f02766a8fdda5586661eb039bf4428ebbdc8fff9935c151b2f586e14445093bd9b00042b7ca99a97391574c5dd19f0d2bfc902123fc250e7c99d40f5bb81136deda0670aad2788b97a04423fcc6232ecd0edf1395a66d776c43c36ae355164d0313751241103b5dd1cb16689326cffece7b3035f543f5942d4b7131a835f5d9a30490c14d9fe8129c5f2608a4058d49c4ccec22cd3e6ed3807d8b8d05740ac186ab87020119f527ce312f90f48879412f401e13bb22f1056e815f79b0c9396e0d2294e71b6c27f6d0b911a40380daaa741586a1a3554f4010eff2d3c7859ad37197a0cd29a1d17d59a1788c7996cde3b742d70ce36a2555e82cb79e24771d1763609e40741b21298106e310a5e18615370005fe8d6e1c31783d09a588f168526300c7d8afdb3f8c1f946a20f16f76eb14a4a23bb443dc2093af482a8709ecf1f80123d7d8fd0bc9defedd313c6a69e463cacb572ed8174da9de544f6f277d8a5451981d003b73fdc9dfc04fd28b9addd4c87236df14413d352c60b660b8067686a4a3f4c0b5de84a35188a477816f2331356410bd5236bb5405d4a1be0efa9d45d728b4bfa22b518c2929c67cea1e33608825061ab6ea3ef89ce1e9422c95a6f887ea718b126b9353bcb0a1f0ebb36b6483845eb257338ae5aa23b6b07144ed05bb206f3d92ecb4fcd0a6ab2960cbe998bd6d1dfbb0a6b45d27a6019986ba37121cd0a525d850a0972a09d9ac96481664ece4cce492ecaa9e17ea05a0c8eab4a2bdf38e7bc732dbfc50b29d15b43bc2b95e06091769a8273187e76d23687f3b406b97e8357c23cea08f6c2fe9eba7ef2dff34f9dd0ced29f479451e5631ce01f948f1b346be6d55be2e758c1cfc7766f693b9ac9b5cf0b666fb73f031fa0817b61ead76b97bf87c7c2cd87c3222ac200194ca98f6c5eb51b45c80b35e997e8583c3a0dcd9a2d16f3642133715ab628e3c8f2c3853d91818aeff7410f4983f6ce03d75193fbd66c425a1e28b71b4e03dcb5f2a2ebb6654553c73370646572c8ba333e267f216bc7e2d95fc974cac8325fbe4d6a025a77f99f357b38f1760a52b67b1c67c354d5bf9a30af27dc4856fb6b5285c980e44d1a3b716b01883750b42976063a7a872a06a4a895e74421739d98081c59a99ca267bcc99ce2c74ad3052fd2a085622befe690eb7dc1b4e914037f3ca9c7e0034cdf43eb3895a77a4cc6a962793af4651736d0323f2ea35ae665477af0d6dd666aaf440c021a7c4e3ea17aec3c15a2c31eafc875afeaebb6962622b27c34467aa123a86ffe8e51a0a250cc336faa2928ea6f1f51d38e2bc339e5b39266704caf9c155383639fed5e3664276415f5b2a8a56c8c9936c7a1d0a109bdbc1ac4103498630bbe39670cb9093030d992a50387b4cab748505b125ecc8e83bd684517cdaa195c23200fbbb201ce92d0a5104f4ba47b18cbc1015f62bed584f648f888c7e80a799c7b567270dcb9adcc3e51717629e8e5c3c09c5a8ca048e5f85df5caea2041c3288f4233f93533eef6cf394c3a0547a3a0972244120751c0839fe54d7b69b8b3ac5bb8cd9a4faac8e73c05750ce24e566547fb632dd8191ae2251d5c316eaf94f8f5d8e48c24d8aab2cbc9ba744b5d8960dd22e4dfde7f45775e031b0b327d9a2ed07602dcbafdc5b714f9ef36fb22372233ea2a461cd5d40a7b7b31d543348c8b578ca8008778724bf098b76c0a2978f8b79cf555652c235a899215ca243daa8fb74f546b9f0f5ed70bb47db043bdc96e4cf2478020b621bc503f3b25e0763879b64ac99167ad999a2b32e05ecd3a88b1b8ebada93d710453376824602341512e0b2a4d2355a9a65df74b50932ec4e4c4c1516dde37a40312879fb61edbb4da1a264f1fac40b4fa0e40e921ea7a655471f0d2946efa5b979337f5461d3118490a0bfec6a07a65ae29569e9d40507200b804544fdb034cfb3005ca037edb0eea1b5e33e169eab0d4cea3953bc4405b3ea310dd7d8bcdef339b05a7cfc3adc5677e652ff5126acb2143cfa0ba32eecd447fb7617f965f626d7f3c54b479d0a6a52ddffb7e65884e754bb37ca05fb3b3398b35d5dd1f47f71fa206375f9a6e83ffa06a564ad23665c6a259f023ea4cd7816ba79756a60d1071af2c591e4429cb2378f9689bbff5a4d6a273febc9447bc40ee05b69686596ccbe58fee58872eaa1f728f39599c76ed373fb46c178f208f573875da5de61e68233439913ef33e5e8087b80947914cafc150f531c1e1e9be5a82f966431aea3d62df3513712fc7cbb4fa18a00dbb53ed079ace7b6251988e9a76e41b207c27c0f8c40928b95d744ab5422295913553c1942452be050cf92dd1a154394b849b317500a85b9b8ad89ac6ef03fe448995b5b23fd8fa1e1524adb250a46ba04b8cca012a3903b7f539d3a3cf816d1e5434d8ef2e7f39314206c68e9db6e90949da9eb3a1329fd4f9f187c7b00def860f95c71a2e21aba1fa1bef52827915ec64ab0042075cf528fefc8a63d8897f242d8828c7a17dedb7f9d26c5c4ad8e8462503dfc92354f860717c881a879af36242dea114f692149506149db2c931788643d8cff5761216cab5d23e9e0678f613a52b34f56a614d7244c475d5d863afc50494f83cc3e5699dda8db94b3c3db1f56e94a2714721eb70b8db3f05559d4b0eb2b71bab0d04ff0a659829817fb9736b1d5123f6c0ab6bab87ffc30a668680913f7c5842eb4364c2006a5e9dc0f2156e430aee8865d613782014ea6c3f0bd067fa5eb085da9191361145b96eaaf1c43afb0f506a136205921df6b96628c17dc8170299f63d617408178e7d5b39cad0d7df33154467e89f0ba7a6b670b543dbd741aea41187f2bf936f144499470638307d9c46fd14ea5ed807a77cf6833388d6abd1452a7ff71365835ff82717e4ec5cb8b30745ca20b2fe94aef5c3411e1c40da25d7023fc3392c907fd7f2844ffe7544edaf0c2324a9dfb823dbd58c6bcf774f0c5a0e5909973163e2d4f044cd9c3a54f599abf27700013950acc0a3cef0f567d5f5bef405d2a7c3a24a468abbd43bfec53820dc817b0ba0e65b45cfe9c5ee45411f98108858fd6031b4135948c232d0a4daeddb405889419b0be68abeea98612b00c49dabbefae505b5cba7b92dee9d5bb92da993f9ec2034b9fd919636aab63a1179b09e702f266853c89bd136d15a663a97dd37c0caac03063b856337a449c38bee5d86e2e791a0d511788f82547d1b7d37f17fac68d4423c52a07a93a93b7a04a0afc1ac4d1138c4c8c6c2a765c15a41331079ffcbb1dfced71608ada46a14ca15b904c44e4b0391ddafde9d7db46febcfca58b150ddf93de4d7d97d2cf09e0faf2c376d7899ca4b39d42a795f0b34c8ed6d9559352da80cef67082085e55db96d2153cb5ba82e2c83edf6cb0081218d6c29a7444a99b1e0484431fc4632a4275e2e63799cc6f990cc44413a82b446dc847ccbb91841c7fe656b8ad626a5f0459e5f99e3b221b76cd86364267822d0af604134716a32f126b6c469dedabc5886759129f53265847c1c4d52c5a46cc3a5eddcd180f1667f6af63a375ff63f618089b748a0a7cd36fa002b82f4ea4f9dc56627b3066f3a27073e266f72ecee7f744bf868e3e46bceaabcbf33f64660e056ca512530932a04adfd362e5e06b2f767784fab2f89032d1cec848475ed2c246d3273797578ad780e1259aa266a9e64cbc29b1019daa548b782c1553f200715665557bcb1ce9b615099d279c12edacd1dc0fc23b48471e9f6552d52f07d7e629d59a37727e4db7026f99e49468db23d390ade5fe6af92a2811cd38b34428558584f32d0aaf4576adf0de734b4cd0fa20415f2ee29c1de39ff878091ec90e279685bb826221d6d2909d7992a50b8cca6c848088dd18b431f88d7f627d05bec2e5c4ae6d6e734b25c635f83ed086e08bfeab9afa3e5c3364e1792062e546b09cc5d5c1050a698994fdda8d90dc47405a66f7d3d7f075151351c7ac8dded016423b0bfa5fba9b44dde0fbcddeedf27422414c3141dac01517228c21bdb429e789c115036daed78586b0256c730a544879a3630dc012f515be20a59a00ee5907aceb90c3aa91542d5e60c46a6995d09e57ed610e09445edf04bea2509f8bd226485b2fe6d4bc09c40353a999ba73dc489c5044e08dd008d629075588a10826e6c98769cbe6ab2b6e9cbdcc3d6a490dfb9cd389853f929dc0556bfdddb8a2f3c89291b46b1fc39174433605d7db25e7dc07f18fec4899f9cf43a54978aaa0ddb9537cc97304870e81fbe588e1a0256d74062a78e4b29cbe20ff2462fa48a8d36b2be13d8edb2db5747f5a879b25dd53982438e7c5ad59a24df0431cc5e08817ffa9713d3ce09da60bd49c7cbb0a050a166400dad077935d99532068bc5b8f58355c8145d0b6502cf91b8ae90b89748059b4f0683dc2dd80f13952b50233246bbc2a37af56e63d5af9cc91f9ad9446cc8ff2862c48f56f19ec1350bc735b62da5ea933f06d674d867c9349137eff8ba286b2e1203a8fc9c32d0460bc99773bc25673e4a92d36450fb135bc96f0978e61efa4c3f751b69e211ab97e245cfb92c4e4af32572c292aa8a6ef86bc65b013edebb434d75b652ac9c92a53ab11ce50468cc600f0bba960cd74359195055ae0fc59b8fb8a826e9843977ca369ca1c00924514bbc78dd384639367210d4733128c9c2c92e8515a8001e206733357f9bb8cf2e9c843ff1d9b53407daa526fc8f8f2db283991c24560ea996366f9ea28ba13c48fdeecef449af1294a30c7fc47b2563ac9af182c97c79c9af1cbd1d52b542a323de104921ca6374364b734e0d5a1d2ffab86a245e2d936558a984ea1ae9fb549ed8e034fd538836f1c6d677dd5c3bc88851fcb42048f6ce5756a8670127448774499f559eb7fbe41881edc76e5c5313ddb60fb9b8bf10b3747da840165e9bf8e0aa53b97ea94833e207a4e83aa4051efe34e0394546e0b6d841ffe6201bb965f31a1f23deb6ce84df9ac09e91a83659aee6f6274df94b3b79bd8ba2208e26de1f1e0e881fa874a43e083a58e0e9af833b7d2257dd9004fd41a2aa0098cecc188d83104d44dd89c47a5212f214e1fbe38295948e2ddae7a15dc3b3bf7ff21f2e03b57b2bb8b2213e07882bb2e0dabc6d7aa37d09a2c1e89ac227e917631347e20649b77ec8c4ece422eb0c1bedd58f1fe4bd4285b67ed8d250c175ec10ac70d95e8304db1e8d2e111cdbacbbe8b3d1027308f5da04251bcedd12c618032821f9e45d67ab16b33ffacd42548c491';

            // 121
            //  $res['response'] = 'd1b28012646941dd58185ec704a94818f1f123087515238003ee252a8aebd06b5d6b6dfb06cc2f2a02ee374a23a1764cfd09c9245e058d5d6c2de423365e016cd21d8566ad7c7ee72511cb4aa680f125a12a8e93113daba0212966bce35698db217cac0fb8a8587251d05f9ff64f285ed35fedb93311538583018d93cfa236edc28708658af426e29ec0e18301fc0729436849fe9be6fd6d5732c7f101208fcff67325a65c6e054111eb6665d96b8e72b1ae110035b4bed2921645c043f82ff4bff89daa74de31e36365871e920fda964ec9809915bf8c14b0b4857b66c2c71b61f5d717e993d5ae7bcf0b40bb167572e23ab2da1ea297b4455a3488038834f7cc0c958cb0174eb61fb9731ac5977684553071fbd23f21a108d9438d9e2ff769e1ab8af78aca0440cf317e8d97e2822ce866d8ccc45a906af8a33f8c6537256cea168040b1b3f425363c3c51e9713582205c08b2c739851a052b9a44603510a257aa547fd1325c429f130ed8b18004b09fb152456764e545666739a1620ebb047e8d1209e4778c333a8a5b5fc701d449b88d4d201560cfca349cf76931f373536e48de39f55240224604ca3c7f1fab57690e27a22a458372bc26be610687c8333b5bd494da81698e35d24e690e8984f58e5332a93a45e4072e6ebbb4b6bd2dab8b283f22acbf6c494baf8c9deb7e8a33d97d23e35aea8e337eb11806133f0880e04ecbb2ac766fc3038d790c7c965dfe8cbfaf45e0cd72261816552ca15addaf55585b14b13d89dc809c62801edab66985b5251e3c66ad7c31e78ee83fe3ba62ee72de8f852f9e944dc0331ff5c372aa182925dbb428513e65aed8933a2d75d0d4aab52fa1e167097ab9332aa5c5f9512c714470577f3649924556850e47ab6cd6aa7ff5dd604e15892d0f7d86a8d4de475b3d260cc1932561963ecb259b8933587620e630e48273edc94b4f94b361ea8fe35a2cc38922619b77c9a552e57b995caf07992e299d11a7d23cb8d14e806478671e956176b1a262d1abf51bbee0ce606dc29182b0ca8d94e1fe0f81d10bdb7484c25a3e426407a48d53b888a8a306f53773e511ab7240d8986dbeebabdd3221a24e10bbceb58841577a4f72c2d151f2e03a0ee0e9f50256dbbb9f5b981f5cf5ee6d24d122eaac1e884f8e3e5a50aadfbe927797f0a2b283bc2995d5c43eae3e87057df9be5a945ac5412c65d8bbbb9d44ffa4d5ba762ce38ee9dd643f9cf1a44030f2392a2fd1844511b68e88583ffa57ccad1d70fc82664abb416dcf6dc4f1f97e4d7e0cd6dd4a16f75da863497c3d087b13d9046dc797d1e0b525d6e8c3633006f6e13eb62a16ceaad2abe2cb8c7730cd9b1ad5dc380e62aa786e4cd55f459341682e5916a3639b6d48277a20d40b776973b3a2750f20889ca637dab0f2654abcc1ea531b754d7f9c690d07b64fefc31857dc5ab0b0e02d701b4a53285604d21ba44f9332903a46570464d10c5dba9cb6f94bcf9240d480eddc21329cf3f491adf41577de9997581db36df86a11f99c9e20ef5ff5b57be8d759de430b20448ecaf83afdd56d95087ba0e089b9f233d6dd6aa61645c1648e45cf294f3e56f172edc28114cdddb4892899a5c026adcdc2b58c7d04275b9aaa0b78ccc4968deefbc4c14ffdc1a71a1d65b2eaa6ba7c448eaba88a9562d8ff2c75353df9f745a1e0b36f197b3c19fb81d0ee4e63ea925136db97e72ce36d47673fcae10717f08172a5b1c5f98dd3bf7d4a562170f67b594ad0858229edd737182a7536cee306f147623cb3539d5d03af9a0c504281f46d48f46813c55908e1ae3cd5ac9b89ca23ffb26fee1c68a8257b7d93383c984ae7cdbded54ff18ae3561d4cb30e0aa6bd936ccce02866386cb22c6e08108f5f14c7d9fc92b572fcc8eb1f99545e8a4add36a089330b598c60dba766482bab9e651c3cf9a4821bdc18a59cc8061d62ad64e6bd4fb620fe950fa53a9a085dc23f2cdca84579cee8cf82767b41bd4c32fa55f80d00f8abcec629508e2aca262c2095659c0969a1cc2fba2a4f4180242f1798908428958edb66085466d0724992ee60d8218d8475620624e8226b1204806371b43fdcfcdbee7146d692f7629f38d5f54ef8c259bd7aaf951cd7b3c5df857497598997efa22fc6553ec7187be1f2376d00209b929f7e93ffc9aa9f5e094cc7dd86d3f41b80572629aa419cf5e2eb211004784bd41458c631d0c0e12189931148703d0c5f5fa3b521e6d56f234c833ae0a1039942e979287bb28e7dca0914a42560a99fa8c836b7d6777d505aeac6281081dca0a14a7ee0f574bc6aed3a049737b8f352af9d9ee7342c616e9ff073717bd867ec00015a573e152a2fe1c16a06e429d78ec9650e17187061cc4533521cad04ae068003c64a128b936915e6d9b69ccab80bfe985dddbc72d3ba0b025a0c0aeb5af7e6819622ed4a6d4f9c3e33dcadd01a859c489b7e64f1b233b8a2f3d5f8b0e9580b40e7341eb8aa517a1b568ebf64aa22244ffbf8cf218fe4f8176bd5405df145564a0e2736037ff524dd5d439cc785cd62a1b69d1cdab5c5bbbe14e037e92018cce8cdbce6389d1f02820ea927d34b830aa4cd7c7e772ec7d1ea9ca33694e42170579e04ce45b8f56447bdb19f534594a1f2cfcb73dee49f50df40a37d027b024964352de839719442bb7d5fa24122725724cb924c49189e6ea8100b4785af67a2bd6dfbaa9b977b3c625d41b4afc3a47cb31e44cd99a24067b5282e2ac2970232128d40691978eebd27ab0aeec90bbcd98bb839cc83b97d6112c6d6fecaabab6070b8e49ee1564f86191b5a70388604198d0cccbfa1cf2e1d69f1035c5439ed46703f8fa2bbf5fccba8f574047ddf4444285898d6642ade25cd395633f4808812a8292bc244aaabfe34debd8b72a9036a876ed3abf6d5054c4185d99253bccd0d3ee236bfb8092ead1d5aee5fb08b2b77d21361f63d86562e5ba0bc44d33f17ce0314bd916bc40133192492144171050e3a73143822463b43eb602fd2726431f270e56c04054d8673cf204d1e8296dcf0bda66574da3e37df257399acac5fc0a1c5bef04cb2e4bdc173f4822d7b64115d8c6f1ff8ae3a3813467676be2a1f0c9279ab2e59a8df29926709527193c3c2d6d4f6c43f893b6d7eb1386176ca75853df42d383e6853bf64242aa363d1675d11ff96e20be8fa5afac9a7af63ce38c36095c86e03bc55149632013610be72b89564cb307bf88b063e2356324e5935c551394f581bc35465c0ea1f0bc1a770de72c45c00fc05b41858337ade44973bb64df2a50609f2bba14f12fd86478125f3a11b9e57caca10f7a03e9e5c0bc8ab31e96f5b0f64d961f95aa3dca4064010f52710f4f7f88d2b0ef02dc88c91ab4d28aaa36f773acee6329615564d1d36046c6f009577c569dd65246689b2661a1eb3f63912a5c1be3581b96c5f80e65592ae98af1eb5b8a3fb9a3b5e2486f2a7167b36c3eae99e032a829d8543fa5f1004ffc198016b3fa1ab199f6b1255d7831645361dcec9bbb31e04a96f6e9978d184e82cd929965365719cf9d51fb84318dcb2da762f2872cf3a0dd9b85e6157a60ba2e2b158c68271ec15c127607d2d2d4cdcdeb6cb2971b58f3fa040d925870c100ae6117b9292660ebb34033f04b28daddec9b4bc003cfd38f6755d950fc19b647195491a71ef59142eb29fbc1f2fef8b4b6cd29b87c4f3514eabafe1641fc9ad5e4df979b41616e1c04ca2a513396aeacdc9648e02f4083361968678bc4ebff8cb03be2ea5c8a4a380d63c5d448585fe7eb248077395b873faae86eb9edfbed2337c916a7f33370570b74b028672ca0656eb7107d519f8e7c5f89908a5154d7d95fc53b9c411f3d3c5bc54400af79baa62e2d0735b7230e7bb4d7b6a3826e3f5c77206bc2c42351463f3e1e61484e31d05ef8e6059ebf6ed5b6fe6e13fb02e93beb440036104eaf62ecddd596ec780c1f20dee3f9724d41a000746b400ec81206e0be017403545b83459d55f18683a7e87e5404a6db3ee67ddfe62aa28fc335205e02e3a5aeccac2d580d7e630c88e8420b6e7d227d4dbece2a252c06ab58ab53557077dc5f4a0aa9c7c751c45c753ab1e1fe1baad000abfa117637fbf78318811b370da28de38bd0b7ae04aa70e3795b95f198f37afd0e68d482dd8e8aeb16b226f8ca0a343bc6fd4f5c11f221689e4bb34ddb4bc5eb626be626afb4d316b15c8912abbbde6cd30374b633885d30eac34ad6de0aef9bcbfdb536440aea49b518351bd8cc0a2b5fd252e123385357ffcffd744dc9a20de82466cedf91a04c4e4570dc091944fe0d99bb9ed8ad8ce50a9e56295af3712ba2bd2a35ace436b5d102026a31f341c1551f81364fff84a17afdb20cd4a9fb0b77afec120a7ef3169938602dcca025ff0375fc0c97d00696913441643e2821675540e8d0e97616dab2bb2ebed488f50599b61a6c5f03e93e0627f78949bf27eda5a8a3a7b68ff53beb45f9583aaf024fc65a867ace68b29330fa7a6d2bfe41a82b580265de69270679558e8d7e83e49df1d91179adee9f1fef11d8f30545ed1de034f3aef2db9f177c93e6320e9c8760cdb00f1a0b4fb60de8ecf515ccfa7f91f8b1efa1d808bfc9769f152795f5bafa16df90a52e795c4939c9ab40390568e3b89d94f47a3c79b021d8d8baa0678a369fefb5dadf37b224cb1e50df270693a9321358458abbeb8c0861bdb7899e34713bc90b3fa31f88a515166e40e136b8c5bd7891e9e77e759eb740fdd6814656b5c09f8fa43ad0dcc171ad4c18342430b2f0afccf3bf81418090614b4668a7dc545aad2235588eb1f3d1541caabde5356d4f8f957825bede1261bfbd079d87d6edfd0ff128906861dbfb633fee0717f259c2d82e9019a7e35972f243e6b45afc8847a95c23758fe31ab4412e316aef565214828ff38021faae84544a50c65b85041937682ff3ef2fab19a96199370d625ff112e11f6a838e3f9e8a1a307e745b067e2fa7f387158219405d18266991b2d9d809e1c43617d61e687d4cf7cc38c5ae29d14b4a37a32b8f1601477f9b87ed387883e27f93d9fae776f8ef9549e273efe7308e5dfaed9ff538e238ced70b3b7a22943522411040549975acd79b9ce9f41ebb37123ea2d5a4f0c62fc1099f02a0729a7844bd22330dcbf532f356d08f431d2bef46f0e64159b60577f8d52b0805f8fce51bec7d49f6426262ac74cc6e03796adb4a039542eb5e32b5b9754235bfedfa237875a73ff184a115e6eb838dadaa575a24ce0e45375acbcaac1592987a5566673f62a636ea30790fcdee5bc226a30ca8f4b0feed23623e9dfb25d6cd8a2d90e21e19f9e18b7e219200dee54bb199364ef89669ade338df030d7c02e0432a6f8215c8cefa0f3fc502cbdbc139de60739e634eec1c0290e5af2a78b3985dbddf15df6d43ace8790f0e66f4263e2c0b95f355c93a8f51484a5f4638ce64d1a3e76763278bb4b3945f3b552f9a442ec8f2dab6ec26ab3a6c01062334dd06ac675783ea21953169572152ef6154bb5446efd5557de1efc54caa8ff2475064c8d977fd24ac4d669ffa58e2563371a8e78fa5449045de47d148ee37b8ce00a40066311ab38ed2a66685f8f632cdfd671d16c7d14359a7fdb1dcd44a0c9a854b3eeb7d51455de31a010c3008f0c27cf631db8108edf8f0e1401408bfe9b330f7f32b1762c837c964e510d4206cf7561ec5495afb5112cddd2eb884bf7141057c7db99a0887d9a6c9a93bce4f90db658173249b8eb4a2bc935ef9f35c3237f7d947f37bce46a8f9e788227336ebaa6eb69f02565f45d72837d934b8d94821d899d605ce208a1ff9546989b23a930c9b83f61f027f579effa1b1c6e203d60d8b7054e55994f43918a3e4793439ad2cf35c305b9c0b144bb91eda2f77e80cded4de5381c502b787e1fc06a222b6186c399478ac3f2ba503d22e9187d32523c31aa70acc38938c719c98339c77b96a15ef7005e7be1921c8c9e63d8cee16a53bf9a1b17f71695773979ede72c3c83208cf9598cb3feb04ec4b1bbdf71a3c08ab1d0e1dc8f1b0952b1e4205e274e3857a49e8fb3b2f3582532b939a75793ba8a4388f344cfe1dfcceee0cb172b283430d1897362bcb9141e7f95aadbc23aa8df21382d9b8c53e3e3494f390be38347a88658b038462ab8623317756e3ec5c105da1ca3fa424740362120f9e3c3b96454813332662802538057f3295ab90dc1213a6ee85f25cb7dae59340c9adcc58d317fd00985140bc467877a76e64f1b4422b85a76d2b71c366611d26a8b4424ed05c80e35a209ac444be6d0d1604e2480439123750be92375c6d0cd8593869c92a5cf94ed0e5a7b27418910c8af06a5c1cd7725b6a728737a0dcdf67e14f8efb651c459cc0a97441ba267a6553f9f574e0ee1f15c15a8d142d48a502060fa9538b85a576595fa58e50b3b1f6a64ac72307410861357a3efcc644b1db1f266513dbb206830d3ba0ddeb1385c2550abf92e9e230f95f23e7406c9aa949f0540a9934cb24f6f148dbbc45ec48030ad939ea17866fbd1d5796df0428db9f0aafb86e0236b13bc6d80676fe110baaffa6781864965b01b64adcd0d466db242fb197d57502fdbe574385fdb7ce390bf1919c901e9c68c955ab76b30541f8dd1127b61df33024681b648147a3fd3405';
            

            // Aditya
            // $res['response'] = "d1b28012646941dd58185ec704a94818f1f123087515238003ee252a8aebd06b5d6b6dfb06cc2f2a02ee374a23a1764cfd09c9245e058d5d6c2de423365e016cd21d8566ad7c7ee72511cb4aa680f125a12a8e93113daba0212966bce35698db217cac0fb8a8587251d05f9ff64f285ed35fedb93311538583018d93cfa236edc28708658af426e29ec0e18301fc07297d66c72afc018c18a9519acb7b6db61ac282fb6bc03027dd9ca603deaa482de089b6f7b625b945a81b0bad3f7dbf951c41dd5eac2016c1b67d7aef88681ed77fc304740f217fca2852462ecf55c17e2e7ff165d1557a55c357e4ecf4b25e653211d6eb6c7f5ff6927b88cf4462983c2e6b91f2ed1f1f62b94c9c9444871fdda3a67bc14cbb358a5be805ebda25f5c30186c24778d9df48828e25f8795f9c4de73ce608d4b3fe0ef7101de14519c24d1c7eeff1b3f4afb7d3fc3b4dad2c49d82371270f203a1a5f13da80187df6ade459ddec7514c3824702e501449184fef92a879a1f0e94b123316b511cd41d02c35f2b577e7726ee9828ca2b9b0cb93b8f1dfc223e96cbe5704f545d9df11a9cada69ddaf271d4e6a400842b2f52c939e3e59d34dcb54d0d17bd055f3235c1692afadb06068cc89287f9f087d7d8bc0457a209d5a6bb7cf3d422da25295f111db4e4fa61461370b382372cc136bb093303c0cb4c3e29cfe38b24cd01c73a350eff9a37d6ea4ffefea47bb9f406827828d48f16fb59a2f2747308f980ee0d4481a18ad1439ce271e808417da72ac14b083de90a1192e0855d3ce2e61f0907016e96da25c36a68c89b9c44b54890d2928640fd11f2ca97f61d6805bb53eef6ab04194e4e147de86343db5586a9fc3cff2addd42107f2ee8e21ae7e8a085410aa0a7a16242689e4950c60484812a91aac663da0b4f2f19bbfff4e70e834dce467bfef57e24f919d82a9ea5f789680163525e98915a116945130bf92d043265ba062f6f90a51becfac9870eae915adef15bb34aeaa494afe4b577719c196ce8bd14115104aaf7d2272eb0123091ea589e86c30410822b40ad1ebccc9820062cfc8c9a36d996761cd6af767736b28ed63d969f3ab4324e3e8aa2d819d792b2587490438dc0d31fbeaec2175461e42bfbc9da520e92b905fbc30a7c4f57ea81f76d4937769e4bcc78eba95835de308b56e921d24864860f10ba13cafd580c88f52521a5f9916fb2f949b362681a81700a9eed852f0290b62f909eaf569bb232b547a65aae5f66b20c96fc70982f819e345f1462046e3be9fde06acbd7491396785596a13743903d9f6ccfcf0d829e033669dc73e35b766830a30002291dc2a672172db54ce652a2daea9dd09e0ff15e48c603e14bf9f7100e8ea8ceb4fae638e335eb05eabc662bd36b553e759fc150a8d89e1ca290586bf6f571146cc20f025bb66584ea2d634e54a7832b5beacb196de7124a61d8afcb4d31b5f9d441554654c925754d25a3cc043c70ccea06f1bfe88d397d3b2f4e48a69c49ac4694e4ac1a72224f52a49a3e6b6bcf426c35c406f74a8bf4132c96a1181004a02da6a7b3ec1a06596f78dae6e340c3c1753b1acd311b24203a65798e8cf1448ae8604663764e3786a058f48dec61f493b7b559a2a94f40edf2c3c39e0bd4e451d510ffbed77bdf830c003fb0aa0c25c4fa736ba574144b898500a2c9a58b89d701b41cd5ff8221e5ceee5105e7e2fd8fb6813d1a079ace6fa64011992d9fcb0aedace7510671a4164fbe436c295f4b46a2eaa83999451f75f3a5f8830350fd68ccf1dc34beb98061d9fb9284028bb07a100ca9ef58faead1729bd5386c197b4089b2272b71d3c46997bb67a6166fd63f69d25c4380ec20d88e99196a9a4e42b4b0b761481c9c50472451d5c93db49a2d4c7932e99418e4180eca21d9978ded8133e7ba447256984fe79a424aa97028cac04da301c42e3cd400eaca6d028d1930c3ab50a9283f110bd72a83cfc3fa59c03f0e7ed7151497507fbdcf3f884311e7d6f20b2d44176e147c3813b4def8d164b7f9eb53eb3babb3734e4bef28801a05006848c4a26320bbc1622a6ec4fe4e12b5b532946612dda2c0968991861c1a9ed0ee949b3608f07d41ccfb82a03384a8a3a850a41dd1889c81cb7481c312c6b32f20ca7b16393094fd4b010cd5bd5b95a98329f416bebc765a444b9a671b8194a4b5e869940693823bed5fd2cbcd124045b322c81abccbdc2b3b3fa87e200de74683ceea848436c4332ca4dedbf016085c5e31cab09353db3f69e739d5a01274e1ed236da786a41b11748b3800846fb04c738b36b4052da72f38abc38f41e8c75c4dbcb7d1725a123003bd8a798a78ef5e506980e806daf619abe47f99a04b4e6199767410b5e6300b2b416a1118d6acb05d050c7cae88780526fb4ceae9d176ccc61681333e4d3fcb64c54d6c0888bb1c4159d6733faabb908f34c999e2733b693e215e75bed093759435c69c56867b2d70391aae002a21414417a97b6d8313c3517c3189018365eaaa28208e6aad663a602193d3f5e1a406aa4a40ca3f4887d4ffb990ea81e3e4fcc7e52d1a2ad401d1f5b5532c382a54b82238e62a5444fb10188fdf0d671ff7e89698bb2c32f66bc9f3217c46f7b4fc7002da44a17f7e4ab83b0ca6de592e9812bbf257289b06b1985d3181ecfb774cdaad1a6791fb5ff51f518e9cb9c27e1fc295833b01dcc4ca2deb0ead8626f30ed462e852df663db5c37afe44cf0ad22db3078675dfc0bdef1ecef506a874feb237f0a7ffe4d75c4f7bf0e59555039c2f04b8392b8b7396f0df6d9c0b18eccf9933cb64a9e9a877b04c69603a32de759d71224756831762cce8a9ed0049f07d9ab783428ae096915e6756ec6488789095c15759f976d2444278ae01e1e1f7d3e1d368fffba363220c4dc2dc47e257ba9d4b456b323a74eca86d273c49060f3c0fba55b7dda4bcea05c8eaf1ae18eedb4643e3a5952015df569b06c01840d3239df10c15e93b03c56fa461b5be41a8311682331397e828ec78850049d19079a03d4db88f94a508acec91b27af545539742e47e62059720b8cfce091643760ad7eb3a7a8287e0ce32704a58ab73dfce960f9d66108a09a4ce74b6b42330811632a7ccd54a6aa7dfcffe07ad684127fd4753033c5aacf96a4473b6ef27d9187bbb6e8fa24b1c1f38eebe7a1bb96c1e322e7e1c68e218da5207f354a028efeeb2d2853cd55db039373bc27f8d58ff5fc5366f5efc48f93da1c2fa4e87f9533cc2c6d18307f74ff6cda8996176321c69893f9297076e02a9427d41b117bbe7d802cf1c3289e335f9d8f449c02a565812f912ced6df4dc72dc5b1440d36091f1f8a00c8ea8333938105e588b995edfd36a0dd001f2bca5a5f66a671c5662c03ff92d218382ecd3758f2ab88467debd672331a091989d4d702f1eea3fe8176d626281cdaa3c1392f7cdbc80f0c1040c292c196aa2aa6df5f59e290dd2d12c04ff75a980dc8bfd105b0f7055089cabded9d34121cc15da0a2ec4da925eb7090ad671003f1166c265a8631f6a78c1520418f3b8cf9db2d25d29662853295461ade9eb1d16b748819ed0a69161eafd1031723eef90a60a4f0f577e8b8c9ce1af427d41697c3e8d6c56ae68d4695005bc43824b4c8f66123d42b28eb2e483acc35a2b5e0c8c7223595dda84c9b66f7266bcbd1ecb13b0fa56b7acdbca23be14a546e13a9b137fc305aa1466a05ccdb5e2272c5a76fe77d9c1965e38e8d804b6bc410ed3676048fb57a2bdfaa27c10807e314d1cb360799f0da9b3ba1a6cefb8ba019a49bcaf9f738b91a0a8ade77dbab99257dc2b79a1dc21ed611cf501bd0c8d44ea3838c20b5f7df9583e21c83e787c4b17aa681febfa712d03a8b2c70402935cad2740c389c16bf86429a924252afddf34fa60f66f1e3856308aa6bb448531f4ec82b96f75109925f337582ac6b34c6e262dce25a5754cd153d7f353609d6fdff3ffaa70a1a3b2be5501ff3cedc33ad47a103366b6c19fe79f0c8a7024b35495741aa1152143b34b18cee225ceeddd4f580c0c5cdc6b95c3ae4786d0e30e57cfa427a0217ef20b2aedda4f87481e66fa67f5db20942aace38c56939552f3a85eeaf528441ecb584cba6df6901c89949e41158d15c1b9712ef43584536113ccc1fcd9f2f444047be6bfaaa6ea9d7eb702b9f6a09942901609ce31d7969023950caec0a75db502a3663a65b892939a4610e6273133c5455a496c2ec801670397b1881a38f23cc2eaa84a086fe1d33edb3aa35fcd876c6c0ee3f8f1fba19fd74f5ba28c1cee1409420b79324e8f85bdd924d3b2aed208609ba0ca922d4458da6af23e658cc2145741379fcf18cb7e7e0fc3c013f1b13dd2404d7dea2ead652948541941d8342b8ca7b3195e84644f2f85e81ab238e266a745d6b47d95ccfec7bd3cefc420e925e7a55a2f5dbfea234fed83b30f033524522d9856655c617555c46b06ae7495f45ebf1af63c0e964a268c4d65f81db6e169f56b117607a14fd49650dc6dbbebd3a9896f459a018e60312b1cb7e8c4937f17554e1375a674da821bfb76f6ac068d12d9bc14db1b79acef16509bec0ad1e106435726f98af03561b07a11cb98bd3a91b5b2964d333ab948093c16040715e2d95905ee509eb75c2217af41e3bbcfc221d902fde77925661955fdf2683658e39f50f5bb199e7f3ec584ffb913278940ce2f47cf504d3b1d69bf81aa667ff90fddbf6815fcb7f939123d9d37f503440888d1ea8bc6c794252558cdf54ef6fef0075507ae0d2caea230bbcc74f1a46b8f30dd36b48478f1cd7bd076442e42332636173338ac84fa39623f2e8fce3abdc8b9ace8f557b61529f65b4926dd07ff647885e1d2ee1384d761c7845465ef49cf16dcdf44a886bcebc542c9a8edbd9717c1f48c860fb91a850fe85b8b6b7142fbc0c3967b71100c4b9886164ae3e4b9d2aa45be5333bd04246c6bcbcca3f7c0a23170fe5bbf9e5854fa90e74541bd6aedfef928008486c2699c6cbfafcec0098ad67c237049aac97ad5674d824ddbdf20f8ef4e1c06869870380594715467c46d6609b2ff48396ab9cced3d316c5316223df9c07a47b3dc28c2a110119e2f870798c64573e6fdcd2e09845d0d171dd418058322ee89aa6ce13859c861dc030f7e35a2e7d8c87fca9e6e1399866b14b2f2711c5d3745451fd8196712d6a7ea74aa1380d84944c820607087b34713bf9409dd4d3dd4ed4e6ea1f1687f0019367e1322ba5d3970ab6cc2500c33c2fa6c5bf3bf01dc6ae78127f26807e6dd486cb0e63e354deae586e3e9c3841206b59ddeb4c5b05a78c0730c4819e5e320a9f22fcababa9f4a2d9ee5157828a61e0a8b97095e4f290fb5155f1ff91b8a299889266130c9cef271a0f7513be39e88a09cbc3ed78b32faf243694ea85c76ce5ae4dcf4f041f94744deec68b487b13dfbc474f77b4fead4a6f933a324e5a63a021007cacc742021fd313d4cd39a88cbb95e502fc9f31d9fa7fe642718c4e71f3d1c0b46b50d5bdf18ac71578bc20c37317ba26f597e10e637fb988621c22a1236abb0d9480e73fb73a8f2596ae3f35888028a6abf1c77e2a96aa7daaf31079641c8bafbbe55534605cf61fbcfdcff90ee3ac88698a488287307f269d9519e3279e5236e13b17eaebf59db38c8fbd6d575dad8120f512af0a3255cccf391fe512590d9aac02bade75fb872cc8210e20f49a375df164e8b20a241b00a72b0d9c16ee3e370d5ec197a6ed3d16e4371e503f88944abc5aa914b41ae0c863124dbfab64ea4c7e449b6702f93cb8ab5fab4078e4667dbfd5a7d3366f8415e925f6a990237117ef7d0cc8bcb5e87ccf013ed5761b731b2fd9ea85963efabf7acbd1035b91f57f133cea2d8da3dcab245d1b7d757ac53a4562385c6ec83fb598bdf5b4031d9ab255e2a25602d5faa282bb51f8eb7ae7fee5fc9ab2fdcd4f3394006236527492d8d64b0dc5f4ffd9cabc80a02f4ebd11b7d6e6033213ea5a2e65c283e0a8501aa2e229f5bf59d49ad5e357986b4ceb95b339761eea37eb9165022f6a185506bbee8b97a650c777a05fc3aa741b42b0a0d40e46872248cefe025aaa111a02e9b7b4b4f0e91b9bf66213ac0a791f60e08145b95ff37b9742b74c1eb53c763436ad52a8b0bf109d92b0b2fb55eb03e04c32d0db872c47297c68edec32a27f0c01d7fa8dc2ba08b0cc201dda1f6f6be759c602ea709ddde270e9cc897a43aa7513120c23219e2803e86b0a85d4c72093934dd182b26af9703c4aab759205a1cfc8917bc0f70a5766876a020c36660685debe16bade292663db057fd6e980f2dbdbfcd135c395456b7b6084d1fae356ace238c8a5cb8e9d85c288ea5603cb63a4a05e34d41e4160b1bb200c09dc2cf86698b998ed884a94d87614205d188f99bda3df78e21f6cb888b68c7e127c5bc215ded748588db9225e4a639941c23de7a3fc4fcb1c506aea7ebecc5af42d1e0536f9ba8abfba0c29fe546e9732ccb2010f6e16c034b0b9259ac66e39439a02f91ede28d03e29abd4e9225be5a01982275a0155682eaf4f495873a89109d939fa3a7580246747b9c83579db42166564addb733c352fa4ad82bdba66d3913731056b073ff3a8fb8feb9438b754785d10a825a82e054dc9fd33ac4fbcafd8069fe7686ec0fb763deb342f8dbab05ae3dd3b4e128f65b33b4902b0ecddfbc067abf937faca44fc3e2962dafad94bdf207ca1e9bdb758955e40f285312dc96c6b877582397faf3836d3b14676c6faf74d7e5c364d9a3a679e42c277fe4cf7876b61f7fc0c06e65ed93048775d12e47f564ff85dee986f0ad475ea9cfa7a87f72cabbd2fa3e17747464ded192f7a1d5b571b587dec6f24e179e2bface292d8742445130430d894b72c6707f5225485bda7530fbfa50870d2815aa32cddb7adba88be97d4f1bec49e68930ee8a5586c8c7b5b12c1d9bbd0fccc39db6f8ba6d0600b1fd03e88cb1238215ce402b5c8e673f91f38e7df9e222034a526b79c8817b2cbc3aa0d84d76369531eac043948644be37219b9557c9208650dfecd82fef000ddf3ff0eac1b8cc68532c092e0c4200d645efa21ccabd02090349323ab1659c3e507f348b5e922790cb065a9cdb3cbe5e275aa98ea57cc0a62dacb977e719678ada54f3d600f37529ad941ab60915f43867b24c0c7041bd15";

            //  dd($res['response'], $key);
            //  dd('hgygg');
             $billerInfo = \CJS::decrypt($res['response'], $key);
            //  dd($billerInfo);
            //  dd($billerInfo);
             // Convert XML to JSON
             $xmlObject = simplexml_load_string($billerInfo);
             $jsonData = json_encode($xmlObject);
             $arrayData = json_decode($jsonData, true); // Convert to associative array if needed
            //  dd($arrayData);
            //  dd($arrayData['billerId']);
            //  dd($arrayData['agentId']);
            // dd($arrayData['biller']['billerId']);
            // $InputBillName = $arrayData['biller']['billerInputParams']['paramInfo']['paramName'];
            // $billerId = $arrayData['biller']['billerId'];
            // $min = $arrayData['biller']['billerInputParams']['paramInfo']['minLength'];
            // $max = $arrayData['biller']['billerInputParams']['paramInfo']['maxLength'];
            // dd($arrayData['inputParams']['input']);
            return Inertia::render('AllBillFetch/ProceedtofetchBill', ['data' => $arrayData['biller']]);
            //  return response($arrayData, 200);
        }
        catch( \Exception $e)
        {
            return response()->json([
            'status' => false,
            'Message' => "Ip Not Whitelisted Yet."
            ]);
        }
    }

    public function fetchBill(Request $request)
    {

        // dd($request->all());
        // $billerId = $request->input('billerId');
        //  $params = $request->except('billerId');
        // dd($request->all());
        // dd($request->input('billerId'));
        // $request->validate([
        //     'inputField' => [
        //         'required',
        //         'min:8',
        //         'max:35',
        //         'regex:/^[A-Za-z0-9@\s\-]{8,35}$/'
        //     ]
        // ]); 
        try{
        // $feildName = $request->input('feildName');
        // $billerId =$request->input('billerId');
        $key = '2940CB60C489CEA1AD49AC96BBDC6310';

        $url = 'https://api.billavenue.com/billpay/extBillCntrl/billFetchRequest/xml';
        $data = $request->all();
        $billerKiId = $data['billerId'];
        // dd($data['billerId']);
        $inputFields = $request->except('billerId');
        $test = '';
        // foreach ($inputFields as $paramName => $paramValue) {
        //     // dd($paramName);
        //     $test = '<input><paramName>'.$paramName.'</paramName><paramValue>'.$paramValue.'</paramValue></input>';
        //     // Now you have both field name (paramName) and its value
        //     // \Log::info("Field: $paramName | Value: $paramValue");
        // }



        foreach ($inputFields as $paramName => $paramValue) {
            // You can use paramName and paramValue here
            \Log::info("Field Name: $paramName | Value: $paramValue");
        
            // Append to the $test variable
            $test .= '<input>';
            $test .= '<paramName>' . $paramName . '</paramName>';
            $test .= '<paramValue>' . $paramValue . '</paramValue>';
            $test .= '</input>';
        }


        // dd($billerKiId);
        // foreach($data as $paramName => $paramValue)
        // {
        //     dd($paramName);
        //     // $test = $data1;
        //     // $test[] = '<input><paramName>'.$data['feildName'].'</paramName><paramValue>'.$data['inputField'].'</paramValue></input>';
        // }
        // dd($test);

        

        $xml = '<?xml version="1.0" encoding="UTF-8"?><billFetchRequest><agentId>CC01RP16AGTU00000001</agentId><agentDeviceInfo><ip>124.123.183.137</ip><initChannel>AGT</initChannel><mac>01-23-45-67-89-ab</mac></agentDeviceInfo><customerInfo><customerMobile>9898990084</customerMobile><customerEmail/><customerAdhaar/><customerPan/></customerInfo><billerId>'.$billerKiId.'</billerId><inputParams>'.$test.'</inputParams></billFetchRequest>';
        // dd($xml);   

        $encRequest = \CJS::encrypt($xml, $key);
        // dd($encRequest);

        $parameter = [
            'accessCode' => 'AVQU51SS09TR19KLWN',
            'requestId' => \MyHelper::generateRequestId(),
            'ver' => '1.0',
            'instituteId' => 'RP16',
            'encRequest' => $encRequest,
        ];
        // dd($parameter);  

        $header = array(
            'Content-Type: application/x-www-form-urlencoded'
        );
        

        $res = \MyHelper::curl($url, "POST", $parameter, $header, 'no'); 
        // $res['response'] = "d1b28012646941dd58185ec704a94818f1f123087515238003ee252a8aebd06b5d6b6dfb06cc2f2a02ee374a23a1764c1a869dcca03baad59e178d68114572cf9df93f9c9e1fee3cf78f1a0d64c3e959cf7b1e6cde41c88cf055de876d13fb5a7580f95f77df36b84ee1992633270289ef65c290a7444f9e7e2e5098f6eeae2ed75df56a114fb3b519083f8678bec5a855bf30f5964c94d1d81b364269ebffcfb0d3fe8f7031dfa716507c91cfb4f83eeea18e867718a884648910332af75eba6ca5d712c970a3f70e6111d78f762618398c383d34da55e41a88693d3070ceb8f60a387c70050e564ef814d5dedff0886073dd0f8e6881014175b429e68711b3ce36ccb1676a8c0ca526bab897b05764fb65dae7b1e3a8e9fb09df5c92fd9dfaf2bb8156f9c6bf03d4e3461e71072c351650c88303675935093851f55d7384348f7dd3958df5457935703675edebed6a878c84161c5b2ee1d4928e68858c3b39e9d04d60fe931be744a43350b2f545c0d1babe1fa31af14d92d25282660a918d75d6a80af05837fa5ffc4c42a830508d5507aa75191e4e406aa842507944e3e020f938d2b29d01cc6c11654dcdf0e266e0c6b074f2955f340cf729f5e7465f6957d810b5395f5b2793784bba4c6784b758b8e1fcafe70c7e0fcbfa09c5e75294a98993b71f4a1ac44d05cd23bf0e15218d1ee5cbaf17228b1c9e73f0d6883ffadb251387198943d27a8ab8bb7e5e82985d2e8880ff310cd41f1ed64bdffdad1dd546a962454ce4fca67ca9edddb1682fbb964e93590eecea2e11d39805f771b0f595d0935dd9b00ea473c6ab5b7b97099a29b1f7ae3e29776e5ca212de59128b6e825187179a3ff1ac8278ae5b39e85210ac0192a02ff588487a5d9aca9d628b9e12d2d349785d34956d6e76b8c08a31";
        // dd($res);
        // $res['response'] = "bf2d0561c5593084bbe58efc63d7996278c29d503fdda62888f19afe0e8152594170605746b1f12226fb6441948ffbabb11a683ec1dd63e21c175f325f3748e80f809c5d139f8b4b6f57392f5c4f358311474bbb8e64ba1da72e0fc38779e66b5516866c17ad3df8db862e851758baec4b33c4b312851c06ab30fa87bb78765ba2714524a8444f3e8c297dbf84fc10d33fb4c355a6d12fed90e21eadd76e1f22cc95914d8d748fc9a41f3864ea12cbfb67f4a758a3c57452755edf9cbb49cd15797dabb546adc04d2a62d0a1474a740d1340d9dd01805b4832fbe3eaca0bd304cf7f6b3452403e8b5ffb0237bf88b7a5fd69b7631039c2ce61da91df82bd185409941edd2f0d5579cc819aee45936ddb68395b1f5d5a072046166f30b8e3cdde1d575d7209ab3fdf2157b9bfef86279234652654a7af7239dc6942156afeff9df493bcb1c9e7b79829265ef6295b553b0a7013cf68859f17dfa0ba75cf484412ac983379c26ad98b993f61d959488bcd53acf4df097b51bcba1cec58541c6165b46d0e679ef0ddfec4315419811ec5f367212746091e630f257457bfdfec9f35052843e155c02a64909b98376bcaf81af242feccb8ba4716bf9f094b752a0dfe92faefe51d9abca4ef40b04c40d2ac905fd80da442c0d51314228e67d86cee9dcede1f6d9f424cfa9bd5f400afdc9d5962e78f2ab41acca261b93e3204d325b0593c151eb97094784faf1579117741d3cf6a89b388f02b28a0853260700d0d1ebe5d697de49b9fa0719f87d145ff1f2b7e6230e27329ea17c0c0d66af9da249fe20b6b049a95e89cc7aec16ff7e2c1c8ecbf2ba2c83bd0b554c746e8b50b4d37720cb84d115ded71ea953d9743e452ea88c453b624735c3067d28343fd675cb454cc48f4a3003267df644599209e978c2fccc5dc8bdfb3388eaf535a3e7b803144cee46a29b755abcdbafb81bc26616a60a8991559edd0130f4620652ae9dac3aade4608566678f81f2cec5a1b56ac979e1bfde0e70a819229c1031664c2a12058666ceec20e13e5b7eab1565b758f58c6c3bc72e27b3e5016918b94018ac64f544bc98af6989bbb47db2ce4b4bf6bd6f805d2de83a4865da43d37b4b20937ed876995802d2a9e97b186cf8c63e9e75f03b230966ff20b0999c78c0cc580fdbbe034438ae05f722a432c9b7759e563dab1e33b8b6c467c3cbcd4fbadaa58dcef7140ddc4c531c14a8e7f93ca9c0e5ddc841788aa08fa90fedea88a47a3fda9e02f2a7a249bd53fbb9538335072232dc4060abba833e2735a92db66f13b8581daaf112d1b514db738949918cb25749cff71884bab46512c78af20420b5122da2381e940ee330940b62183454e10bc92f7f50e1900e3714905d27d73c02a8542981f4a22580b27358ce7c6898f769c316414e81e88ccf11a1e2b940a0cba7a049258c410167c277095e148d6a104abf4a2e6a13471f49521993a282bede1ad62418ce5e08910c82477f70bc8550bde048773df8819c4df9761ffef21fe8618aa1d28405f27a6a5b6d57b6fd2bd460a300e64e2a6680b79511ba49b70f03c9648162dbeb16c4861a6198b5ce73308dafb1f8ce5b555f6543232355d39a3a0dc1d2c36902c752c120300c5e4c1d3415078cfac3964a62c3b2e23924425f9e6c2986414b3fd77e353ad136876f0b3a80a3cf0d7ccd3a63ad94b4b7051ae260f8223f239d2e2b67a7cedc96f52ea869470eaa38a852a587f841b5b4c30788e9e53f4f1c817a3d89f877abba3bd66562d06285efe84ae3d211d74bc131126923680ece26e714b974843d1d07372e59aad8b9246";
        // $res['response'] = 'd1b28012646941dd58185ec704a94818f1f123087515238003ee252a8aebd06b5d6b6dfb06cc2f2a02ee374a23a1764c1a869dcca03baad59e178d68114572cf9df93f9c9e1fee3cf78f1a0d64c3e959401f336ee318257205b86fcf1ac804be8ca1ba8ea5d238eb3438dc06e93101046bdf59895d8c6e1d2a23b112c7b605ff69f4c93a273ff4b5fedc47a010d3fda88ada4e1792e6c78f1bdbd21af7764422a40906d191141245afbf50a8a9d795d112b60f5b3b3169eaea45c51117db9ed3cba59eaabc46a89ad465b9747d3ef02aeb7cf2d985ec26bd47636fb9044fc6d949777e1b12d256e73e8f3ced8a48b004dd57909d88de38b96e1284c926740d38';

        // $res['response']
        $billdetail = \CJS::decrypt($res['response'], $key);
        // dd($billdetail);
        // Convert XML to JSON
        $xmlObject = simplexml_load_string($billdetail);
        $jsonData = json_encode($xmlObject);
        $arrayData = json_decode($jsonData, true); // Convert to associative array if needed
        // $fetchdata = [
        //     $arrayData,
        //     $parameter['requestId']
        // ];
        // dd($fetchdata);
        
        return response()->json([
            'status' => true,
            'arrayData' => $arrayData,
            'requestId' => $parameter['requestId']
        ]);
        
        //  response($fetchdata, 200);
       }
       catch (\Exception $e){
        return response()->json([
            'status' => false,
            'message' => "Ip Not Whitelisted Yet."
        ]);
       }
    }
    public function fetchBillDetails()
    {
        return Inertia::render('Billfetch');
    }

    public function paybill(Request $request)
    {
        // dd($request->all());
        try{
        $key = '2940CB60C489CEA1AD49AC96BBDC6310';
        $url = 'https://api.billavenue.com/billpay/extBillPayCntrl/billPayRequest/xml';
        $data = $request->all();
        // dd($data['requestId']);
        // dd($data['fetchedBill']['inputParams']['input']);
        // dd($data['fetchedBill']['billerResponse']['billAmount']);

        // $billerKiId = $data['billerId'];
        // dd($data['billerId']);
        // $inputFields = $request->except('billerId');
        // Step 1: Extract and normalize input
        $inputs = $data['fetchedBill']['inputParams']['input'] ?? [];
        $billAmount = $data['fetchedBill']['billerResponse']['billAmount'];
        $billDate = $data['fetchedBill']['billerResponse']['billDate'];
        $billNumber = $data['fetchedBill']['billerResponse']['billNumber'];
        $billPeriod = $data['fetchedBill']['billerResponse']['billPeriod'];
        $customerName = $data['fetchedBill']['billerResponse']['customerName'];
        $dueDate = $data['fetchedBill']['billerResponse']['dueDate'];
        $requestId = $data['requestId'];
        // dd($inputs);

        // Ensure $inputs is always an array of parameters
        if (!is_array($inputs) || empty($inputs)) {
            $inputs = []; // Handle case where input is null or not an array
        } elseif (isset($inputs['paramName'])) {
            // If $inputs is a single associative array (single parameter), wrap it in an array
            $inputs = [$inputs];
        }

        // Step 2: Initialize XML string
        $test = '';
        // Step 3: Loop through inputs and build XML
        foreach ($inputs as $input) {
            // Ensure paramName and paramValue exist, default to empty string if not
            $paramName = $input['paramName'] ?? '';
            $paramValue = $input['paramValue'] ?? '';
            
            // Log for debugging
            \Log::info("Name: $paramName | Value: $paramValue");
            
            // Build XML structure
            $test .= '<input>';
            $test .= '<paramName>' . $paramName . '</paramName>';
            $test .= '<paramValue>' . $paramValue . '</paramValue>';
            $test .= '</input>';
        }
        // dd($test); 
        $additionalInfo = $data['fetchedBill']['additionalInfo']['info'] ?? [];
        if (!is_array($additionalInfo) || empty($additionalInfo)) {
            $additionalInfo = []; // Handle case where input is null or not an array
        } elseif (isset($additionalInfo['infoName'])) {
            // If $inputs is a single associative array (single parameter), wrap it in an array
            $additionalInfo = [$additionalInfo];
        }
        // dd($additionalInfo);
        $info ='';
        foreach ($additionalInfo as $paramName) {
            $paramNam = $paramName['infoName'] ?? '';
            $paramValue = $paramName['infoValue'] ?? '';
            // You can use paramName and paramValue here
            \Log::info("Field Name: $paramNam | Value: $paramValue");
            
            // Append to the $test variable
            $info .= '<info>';
            $info .= '<infoName>' . $paramNam . '</infoName>';
            $info .= '<infoValue>' . $paramValue . '</infoValue>';
            $info .= '</info>';
        }
        // dd($info);
        $options = $data['fetchedBill']['option'] ?? [];
        if (!is_array($options) || empty($options)) {
            $options = []; // Handle case where input is null or not an array
        } elseif (isset($options['infoName'])) {
            // If $inputs is a single associative array (single parameter), wrap it in an array
            $options = [$options];
        }
        // dd($options);
       
        $option = '';
        foreach ($options as $option) {
            $paramNam = $option['infoName'] ?? '';
            $paramValue = $option['infoValue'] ?? '';
            // You can use paramName and paramValue here
            \Log::info("Field Name: $paramName | Value: $paramValue");
        
            // Append to the $test variable
            $option .= '<option>';
            $option .= '<amountName>' . $paramName . '</amountName>';
            $option .= '<amountValue>' . $paramValue . '</amountValue>';
            $option .= '</option>';
        }
        // dd($option);

        // for option
        // <option><amountName>Late Payment Fee</amountName><amountValue>40</amountValue></option><option><amountName>Fixed Charges</amountName><amountValue>50</amountValue></option><option><amountName>Additional Charges</amountName><amountValue>60</amountValue></option>


        // for info
        // <info><infoName>a</infoName><infoValue>10</infoValue></info><info><infoName>a b</infoName><infoValue>20</infoValue></info><info><infoName>a b c</infoName><infoValue>30</infoValue></info><info><infoName>a b c d</infoName><infoValue>40</infoValue></info>


        // <input><paramName>a</paramName><paramValue>10</paramValue></input><input><paramName>a b</paramName><paramValue>20</paramValue></input><input><paramName>a b c</paramName><paramValue>30</paramValue></input><input><paramName>a b c d</paramName><paramValue>40</paramValue></input><input><paramName>a b c d e</paramName><paramValue>50</paramValue></input>


        $xml = '<?xml version="1.0" encoding="UTF-8"?><billPaymentRequest><agentId>CC01RP16AGTU00000001</agentId><billerAdhoc>true</billerAdhoc><agentDeviceInfo><ip>103.250.165.8</ip><initChannel>AGT</initChannel><mac>01-23-45-67-89-ab</mac></agentDeviceInfo><customerInfo><customerMobile>9898990084</customerMobile><customerEmail></customerEmail><customerAdhaar></customerAdhaar><customerPan></customerPan></customerInfo><billerId>'.$data['billerId'].'</billerId><inputParams>'.$test.'</inputParams><billerResponse><billAmount>'.$billAmount.'</billAmount><billDate>'.$billDate.'</billDate><billNumber>'.$billNumber.'</billNumber><billPeriod>'.$billPeriod.'</billPeriod><customerName>'.$customerName.'</customerName><dueDate>'.$dueDate.'</dueDate><amountOptions>'.$option.'</amountOptions></billerResponse><additionalInfo>'.$info.'</additionalInfo><amountInfo><amount></amount><currency></currency><custConvFee>0</custConvFee><amountTags></amountTags></amountInfo><paymentMethod><paymentMode>Cash</paymentMode><quickPay>N</quickPay><splitPay>N</splitPay></paymentMethod><paymentInfo><info><infoName>Remarks</infoName><infoValue>2</infoValue></info></paymentInfo></billPaymentRequest>';
        // dd($xml);

        $encRequest = \CJS::encrypt($xml, $key);
        $parameter = [
            'accessCode' => 'AVQU51SS09TR19KLWN',
            'requestId' => $requestId,
            'ver' => '1.0',
            'instituteId' => 'RP16',
            'encRequest' => $encRequest,
        ];
        // dd($parameter);
        $header = array(
            'Content-Type: application/x-www-form-urlencoded'
        );
        
        // $res = \MyHelper::curl($url, "POST", $parameter, $header, 'no');  
        // $res['response'] = 'bf2d0561c5593084bbe58efc63d7996278c29d503fdda62888f19afe0e8152594170605746b1f12226fb6441948ffbab45239ccacf4fff5f47c430d68ed36c57bf86f645a80ce78044ad2555f4ce7c554390a82378edfe21efba9439d0f9438c4c0c698656ec021b54bfc2a9dcc9f66a74cf5d8b984c20f587da730985c83fec1c858d0965d86b7348409c89152e73941a3f1474c3b0b740999a9d1dfbb6d34a87a0fb2c28f1b693a4c3ada20c9635bbfb988f95de0cf4ef98c51a0b0110f3d7da707ab5528d5d74ae471294f55e094122945d6e5aea5012143038f5ccffd03d28ef081497181d5f310a62ad199b366be2ba316769519a7d97fdd364995bc86060a0237b73307e991bc17a586e2197dd9db5dc8020872f3b68e76dba26b76062b2dbe37c5fad10a103dec0e985118015ed4690108b8c0b1771e5e4e20b22a22461cd2d09138c69f736a300234d8b3c33ce02b4a61751c6294483639084e76bc7132de53470162dc539b912ca13c3cf78b3cf915f70d19f4fbb4f820be23d2e16dc6c6777792d3014dbec3f53c0d8ea67b126341e0eadc3baca9fb248a476e062ec5cae742e29ee21d3888f56b121c2a849e80d55a99313fefdfa398557e9cb8fa208e5099e50b44ac5a4fecd244a41b2d18a2a0cd82cb1d01239b92a16bcfce238fdf2d2195552054eb947c388266e3ea2b0ea04dbfbeadd3488467e5d868644589cc33346aa79fc0ab2d38f3a38821a8dc01dc7521f65a08e9556145a155a645f0b9621d3f67c894d553247d34f5d11c8911b3c99275524191a7c36ca8dc933f11cfcb454e1218f5eb579761c1f29d29828cb0117e004dcbab6d95ff0407c448f1c961af9e26de81ba81aa244dd56552bd0bdb5288ed6af7c96339fcd60f5d0ad472afd2fdae7c16f34505615ef6517a5691f8bc7f32fb1933dd6788bbf3e363c5a6d7f5b61c4c60d18c6548f9f291d7aa80103d599f3de9892ef08d4c23f54a84dfcb4c9ee657cb7acfa33d45a850ab055f090bf30669fef0a4f3b9196a96e258b87c6a3c97d5c04e0da40ffa6a5f7fe7e6f834c24ff338841b0c2e163eab6b9f430bc8cd7f7b3998c5a87c9d85dc617721fe70ca87948d3152ccffc7befc069934fba9df405c939db173f127cbcd029ba5e92bdd7a3f8840d0d38dbbb63c78aba0af30f283fdce010dd4617a4d7d13d61fb68f03919d835e38386cbdce75c20e38e6b34667027cb1d5121abde1c0005b00436296c56c1edea49e6cb3a2901e5b62c6072aa850a296bbe9acbb9835d45a8a5cbd848acb5fd119811bb39dc4bd371c676d7f3f7aa18b723e1ba2214ab534753381ea67dcfef655d4326d3b37672a46423f69008723bfd42c7a0ea82db2b6d40605b1c82bbd094cfc6c17c818fc1b50c2c40e1ed91707c691effa6a4f1';
        $paybill = \CJS::decrypt($res['response'], $key);
        // Convert XML to JSON
        $xmlObject = simplexml_load_string($paybill);
        $jsonData = json_encode($xmlObject);
        $arrayData = json_decode($jsonData, true);
        $errorMsg = $arrayData['errorInfo']['error']['errorMessage'];
        // dd($arrayData['errorInfo']['error']['errorMessage'] !== '');
        if(isset($arrayData) && $errorMsg === ''){ //Message will be sent when  successful payment will be done
            $indiaTime = Carbon::now('Asia/Kolkata');
            $indiaTime->toDateTimeString();
            $phoneNo = '9717201964';
            $service = $data['billerName'];
            $amount = $billAmount;
            $transactionId = \MyHelper::generateTransactionId();
            $msg = 'Thank you for your payment of Rs.'.$amount.' against '.$service.', Consumer No. '.$phoneNo.'. Your transaction has been successfully processed via B-Connect Txn ID '.$transactionId.' on '.$indiaTime.' through cash payment. Regards, Nikatby.com';
            $url = 'http://nimbusit.biz/api/SmsApi/SendSingleApi?UserID=nikatbybiz&Password=pjdz6209PJ&SenderID=NIKTBY&Phno='.$phoneNo.'&Msg='.$msg.'&EntityID=1701172112475589100&TemplateID=1707174290606277254&FlashMsg=0';
            $response = Http::asForm()->post($url);
            if($response->successful()){
                return response()->json([
                    'status' => true,
                    'successMsg' => $msg,
                ]);
            }
            else{
                return response()->json([
                    'status' => false,
                    'errorMsg' => 'Getting error',
                ]);
            }
        }
        else{
            return response()->json([
                'status' => false,
                'errorMsg' => $errorMsg,
            ]);
        }
        // else{
        //     $indiaTime = Carbon::now('Asia/Kolkata');
        //     $indiaTime->toDateTimeString();
        //     $phoneNo = '9717201964';
        //     $service = $data['billerName'];
        //     $amount = $billAmount;
        //     $transactionId = \MyHelper::generateTransactionId();
        //     $msg = 'Thank you for your payment of Rs.'.$amount.' against '.$service.', Consumer No. '.$phoneNo.'. Your transaction has been successfully processed via B-Connect Txn ID '.$transactionId.' on '.$indiaTime.' through cash payment. Regards, Nikatby.com';
        //     $url = 'http://nimbusit.biz/api/SmsApi/SendSingleApi?UserID=nikatbybiz&Password=pjdz6209PJ&SenderID=NIKTBY&Phno='.$phoneNo.'&Msg='.$msg.'&EntityID=1701172112475589100&TemplateID=1707174290606277254&FlashMsg=0';
        //     $response = Http::asForm()->post($url);
        // }
        // return response()->json([
        //     'dat' => Carbon::now(),
        //     'data' => $arrayData
        // ], 200);
        // return response($arrayData, 200);
        }
        catch (\Exception $e){
            return response()->json([
                'status' => false,
                'message' => "Ip Not Whitelisted Yet."
            ]);
        }

    }

    public function transactionStatus(Request $request)
    {
        dd($request->all());
        try{
        $key = "48ECC74C29EB85471E7511C54C0F310A";
        if(isset($request->mobile))
        {
            $xml = '<?xml version="1.0" encoding="UTF-8"?><transactionStatusReq><trackType>MOBILE_NO</trackType><trackValue>9876543210</trackValue><fromDate>2016-09-02</fromDate><toDate>2016-09-06</toDate></transactionStatusReq>';
        }
        else{
            $xml = '<?xml version="1.0" encoding="UTF-8"?><transactionStatusReq><trackType>TRANS_REF_ID</trackType><trackValue>CC013194BAAE00044817</trackValue></transactionStatusReq>';
        }
        // $xml = 'bf2d0561c5593084bbe58efc63d7996278c29d503fdda62888f19afe0e8152594170605746b1f12226fb6441948ffbabe6fe3e7c47c11ebf64a79167340dc950dd7a10a0bcc759578e10dfc28023b5e1ad2a078ad52ef53b77859f7f17a6bbd7612f09ac311b5daba73248ae3129ddc8dcf5c004aab55544a98a0862f0cf50c8a014e1ff8b71ce1a3f0b6489c96328641d19cfd405ed993c114efd700550419e18df4d04cdc5805a578485f9fe304ee2d66741053082b1465006e645fc4c3b69808e69bcefef66d24ec574a312327177c2047afbe226c1cc328e3114bf353bddd4e6ef71692d4eb815a8501e9a54139f395f12d1e248935e573188b4b8a35de0a3b3a750b26a5c0b88691922b8079bcc2da25e9d3439dea7b494bdb7e38da8decbe584fcddcab91298493351f3d876fced03a7aea9d7b780c5a9edcf1b557d90aad0d91ed74a82f93c10e90ce0e41bf6281d1157a1a4a97851f93fef2b9e0de82e289f5bfe7764d900ddf1de701855462e6c463e30520ad9f0732fedd9cbbed031e0dcd1d4d837490907473bebf34a49e2ce4b7e9320b4ed9a1ca5896cde547a879f1d5744cae1ae2219231058abd32a78b9a9a5a6946333d39d94696b4edb05a03c02552726980e575afaa1f5b51138c67ccb94453afb6a5a372116e6784b49586984dd165e2d94097b963cc84a4429f590b69d62e6420962a981c366e4f5d5ecf375ac2cc64b73003313227a773853234f0a7f3accd6901ae09a143c8387eb1382fabaec239464d1d6a21ca21fe89a2e7fcbf99ea20bbcb01c12157164b3c51af1b626f874587d81be103e651d681c60f0eca24276d4a34844e68158970009771932bd56352fc77d125c5c788b5215f583fec2399f56c7ac0b421c214386b9c3f41faccf96f3b9b398b0d9619ded54e9414c83a3a382f6e24115c71176e0ef480faacb36a9d560ae3192e1ed09a46ff6d28415d3fcab1936babf7fbfaa10fa3ef06d955f91257803bd73408af4ddffecfc2f9d8d7b55d0aa4b80501081f7518955ddefa71d36b95d83d6696d5e00cb4dc715611d9f33659677b5a7bdee6a967cb24492d12822abbb9b23373412aafbadae6b1372b4b0cc80d1dba501c13e30d8d4b95f5b5f1c2066440d98829718c881b44ba6655e1441de17eb8309d40ac29f9e981fd27c0f2fdb887e30f3c00ad05390403dfe1c8d655cbc3797c1c981f09823baee346287a4b339b89a2ee45aceb656417c4138057e5be2a08de4599cc01e8010b9f73ae68406fba33adfa62d09c3b96f828cc5e1ba39369c21430f8a5741a0e0199b51faf6945abf3ea258c8671b5da2085e78b15bf1afd7473d691756367241c538d8dffa2a0c8c50f0db044b898b971ee278a033fb7f64270919a168935cfcd6884292e5cea325d5be7d0662c6c4fb809cb60ff32e69ae2567cd172a3bfe701ee2524388a0f5e0885c749b1d61fd160a3e8867953bcfc240b11fd769a0ed3d65aebc0c20b3a75571d2ec0bec8344d1381bd63af46fef5e7652f8907008f4144423b0bc3f36397841003545d3951ef0cd3e04f9e60edace9f4659332a05db1cccde7b296f320c271b0262ac0b6e36ad1b05f855b245c3c2931a923e00ca23b87bf05b7110aade25f26837764f1cc1789318c33e56cd3ae13ae8cc2b8c2292288bf0fc70403cbd757ccb8749d7a2eaed6ca975dc25cd0aeb0c22f4414276dcd6783cbc5a71145dac00aa07f936c9cdb0e0d79d0696be6616be76bc88b4fecdda62571251060ba8977c4a62b250a4c2c76e2ab9a39440ed12c8f1ccee7141c9d860feee757c4e19757d0f724a4d2891988c61cbf09c225c71968f507c19305d0575df99fad6f1a25e2a5a10f6ef4fd1e5bb925713c0c6bc145481bf8467de0d83dfeeb0e2aca7c09f2339ed27538c492c5967166970716da4680793f70743140b47d7e156be118e15cc459a7ffa958c4be66bb004fe39debc1546834d9eafefa5bc0b2b9a498158ba194dc5c71ddfe5c7329424d0eaf162c2b470153cd9258b82d817d08e2d3b7cced42f5a9de2a2e116096a9bb7d2f821ac71e172d6c31e5e427879a48e1ec3df62db74bf041eb496c656369a0285888c5a3d0ae2f50e2fe73f4a36758a59501dc933a75ac2d9c856f1530a7a73f3fa2de58e6f748c11bf4bd31c63f1c8d9e6391640be42a4fa69ab1fcb3f9637bb6c010cf0ec9719a8ead4fc7aa53f6679d63c18143fe4c3d73b27a52faf0e2037e81ba8bcba2ad76d45a5543c81feb13467b3c4912e683bc05f7b9c067abaf99a3a6e1e1525eac7a48e39bbb9d7094f276901c605814b0a42';
        $billerPay = \CJS::encrypt($xml, $key);
        $url = "https://stgapi.billavenue.com/billpay/transactionStatus/fetchInfo/xml";
        $header = array(
            'Content-Type: text/plain'
        );
        $res = \MyHelper::curl($url, 'POST', $billerPay, $header);
        $trans = \CJS::decrypt($res, $key);
        $xmlObject = simplexml_load_string($trans);
        $jsonData = json_encode($xmlObject);
        $arrayData = json_decode($jsonData, true);
        return response($arrayData, 200);
        // dd($arrayData);
       }
       catch (\Exception $e){
        return response()->json([
            'status' => false,
            'message' => "Ip Not Whitelisted Yet."
        ]);
      }
    }

    public function complaintRegistration(Request $request)
    {
        // dd($request->all());
        try{
        // $key = '48ECC74C29EB85471E7511C54C0F310A'; stage
        $key = '2940CB60C489CEA1AD49AC96BBDC6310'; //production
        // dd($request->biller);
        // format
        // dd($request->all());    
        // CC014110BAAE00054721
        $data = $request->all();
        // dd($data['disposition']);
        $xml = '<?xml version="1.0" encoding="UTF-8"?><complaintRegistrationReq><complaintType>Transaction</complaintType><participationType /><agentId /><txnRefId>'.$data['refId'].'</txnRefId><billerId /><complaintDesc>'.$data['description'].'</complaintDesc><servReason /><complaintDisposition>'.$data['disposition'].'</complaintDisposition></complaintRegistrationReq>';
        dd($xml); 
        $billerId = \CJS::encrypt($xml, $key);
        
        // dd($billerId);
        $url = "https://api.billavenue.com/billpay/extComplaints/register/xml";
        $header = array(
            'Content-Type: application/x-www-form-urlencoded'
        );
        // $res = \MyHelper::curl($url, 'POST', $billerId, $header); //response temproarly
        // $res = 'bf2d0561c5593084bbe58efc63d7996278c29d503fdda62888f19afe0e8152594170605746b1f12226fb6441948ffbab5ffb60f7deefa2b88ee70680bb77e3c6119491be5c771c6acb871ca31262e336ea5ee1da30a81a7b2595e19205831afaf0f2f470283f70fdfc9a93cd59c2626bfb9a7d931e18472707fcb7daf3bb95b6252590949087ddccc73b5b27266382a4ca7f39da4f08510f4f93be745ceb94ee7b67653fe4cd2602ca4e0bd7bcfc022d982c2b9fd897a33e33b54c5e4f0e7588c5751d2d33a461bc482adeccb6a9afbda0a0764e040fb90db1a2bd57f9c29c0957748039ae9c80372216f5714085682dc839f2b28ccbbb13387dbc522b9a112073ec36b7372bb5977528c5dd65f50fc40c84af8b14231b1e83151297a0aa9160e4c3042a2e04e572875a144437fdbff0e7c72c4819dc176733b7483debab8d7073577e0c37ef745ead49c37afc2a46ccbe018529a658240b0627871f0a9fbe67bc56355383f5b2ef418fae417271454b83f3b9d4ddadacd199dc1a29fb63a4a32b0ca7a892fae08564a7d4bf09a4f8ef7c6041273d1a854db39e4bf21c38ffed6f77a8e86a1ee29e8a81b644cea7216ba138a368bfd2a404a55169ad8e7c1bb5be1af11b47b348d00ee18e8cc6ae38d03981687095aa3a281f0004f3871205c1036c785f41543aa15a218bd162680266ba43c5fa8da1f34e0fc8bdc5b3f6b213f16c699e9395cf786a5512e9ecdb3863570208792ae99f66864f0705dab17fe49348e29039166f342fe5e48f51c7b2564b8f0b956071e495319fb152bfae7253d7f3224611f3dc9befbb6c8fb7271766';
        $res = 'd1b28012646941dd58185ec704a94818f1f123087515238003ee252a8aebd06b5d6b6dfb06cc2f2a02ee374a23a1764cab8720f1d54013d14906431ae664cb76c2ca7005de1deea092a16355e6c51a43586741db5debeab2247b4cd2c325f507bde39b0e8295f140bf6ca3a1fbf3b3f9cf80edd4cf5dfc2f4b088fc9075d0942e7fd2504d5bbb50a8aa864f193a39d500ddfc61681d8a6f980219386e9d4e466162d9283f627597e613707ac4222b2ba3c8adbeb46c4a984bed8be772a5d6c4dedde0099daa8fe0b7050a0c305759e142e3bd60bbc625866d260e08a8eefd1ce87083c6604bb381b86607984a3e0c07faba0a830e2f1cd649f9cd65466ed33f59cac82a144579447c2e843ce6c2018a41ee1283b8a5841c7790363ffabc01c39acbe75695bebfd91cbc5d0b7e290e393f2788af8bfea035d9ca44e33ff434368a0b1edb3bfc5492cf803ca7622ff7c232db85f238314478dc0c8244c6b9f3c738dd84a11bc1b2fa75f6e76510088519ebc386cab17baa09dab84727b8626a588693f2c81a330b05ce1b16632818a251d';
        // $billerInfo = \CJS::decrypt($res['response'], $key);
        $billerInfo = \CJS::decrypt($res, $key);
        // dd($billerInfo);
        // Convert XML to JSON
        $xmlObject = simplexml_load_string($billerInfo);
        $jsonData = json_encode($xmlObject);
        $arrayData = json_decode($jsonData, true); // Convert to associative array if needed
        dd($arrayData);
        if(isset($arrayData)){ //Sending message for for complaint successful message 
            $phoneNo = '9717201964';
            $service = 'OMTE';
            $txnid = \MyHelper::generateTransactionId();
            $complaintId = \MyHelper::generateComplaintId();
            // dd($complaintId);
            $msg = 'Your complaint regarding '.$service.' has been successfully registered for B-Connect Txn ID '.$txnid.'.Your Complaint ID is '.$complaintId .'.You can track the status of your complaint using this Complaint ID.Regards, Nikatby.com';
            $url = 'http://nimbusit.biz/api/SmsApi/SendSingleApi?UserID=nikatbybiz&Password=pjdz6209PJ&SenderID=NIKTBY&Phno='.$phoneNo .'&Msg='.$msg.'&EntityID=1701172112475589100&TemplateID=1707174290641556131&FlashMsg=0';


            $response = Http::asForm()->post($url);
            return response($arrayData, 200);
            
            if ($response->successful()) {
                return 'SMS sent successfully!';
            } else {
                return 'Failed to send SMS.';
            }
        }
        
       }
        catch (\Exception $e){
            return response()->json([
                'status' => false,
                'message' => "Ip Not Whitelisted Yet."
            ]);
        }
    }
    public function previousRegisteredComplaint(Request $request)
    {
        dd($request->all());
        try{
            $key = '48ECC74C29EB85471E7511C54C0F310A';
            $data = $request->all();
            $xml = $this->arrayToXml($data);
            $billerId = \CJS::encrypt($xml, $key);
            // dd($billerId);
            $url = "https://stgapi.billavenue.com/billpay/extComplaints/track/xml";
            $header = array(
                'Content-Type: application/x-www-form-urlencoded'
            );
            $res = \MyHelper::curl($url, 'POST', $billerId, $header); //response temproarly
            
            // $billerInfo = \CJS::decrypt($res['response'], $key);
            $billerInfo = \CJS::decrypt($res, $key);
            // Convert XML to JSON
            $xmlObject = simplexml_load_string($billerInfo);
            $jsonData = json_encode($xmlObject);
            $arrayData = json_decode($jsonData, true); // Convert to associative array if needed
            // dd($arrayData);
            return response($arrayData, 200);
        }
            catch (\Exception $e){
                return response()->json([
                    'status' => false,
                    'message' => "Ip Not Whitelisted Yet."
                ]);
            }
    }
    public function billValidation(Request $request)
    {
        try{
            $key = '48ECC74C29EB85471E7511C54C0F310A';
            $data = $request->all();
            $xml = $this->arrayToXml($data);
            $billerId = \CJS::encrypt($xml, $key);
            // dd($billerId);
            $url = "https://stgapi.billavenue.com/billpay/extBillValCntrl/billValidationRequest/xml";
            $header = array(
                'Content-Type: application/x-www-form-urlencoded'
            );
            $res = \MyHelper::curl($url, 'POST', $billerId, $header); //response temproarly
            
            // $billerInfo = \CJS::decrypt($res['response'], $key);
            $billerInfo = \CJS::decrypt($res, $key);
            // Convert XML to JSON
            $xmlObject = simplexml_load_string($billerInfo);
            $jsonData = json_encode($xmlObject);
            $arrayData = json_decode($jsonData, true); // Convert to associative array if needed
            // dd($arrayData);
            return response($arrayData, 200);
        }
            catch (\Exception $e){
                return response()->json([
                    'status' => false,
                    'message' => "Ip Not Whitelisted Yet."
                ]);
            }
    }
    private function arrayToXml($data, $rootElement = '<root>', $xml = null)
     {
        if ($xml === null) {
            $xml = new \SimpleXMLElement($rootElement);
        }

        foreach ($data as $key => $value) {
            if (is_array($value)) {
                $this->arrayToXml($value, "<$key/>", $xml->addChild($key));
            } else {
                $xml->addChild(is_numeric($key) ? "item$key" : $key, htmlspecialchars($value));
            }
        }

        return $xml->asXML();
    }



    public function fetch(Request $request)
    {
        // Validate the request
        $data = $request->validate([
            'category' => 'required|string',
            'biller' => 'required|string',
            'customerId' => 'required|string',
            'fieldA' => 'nullable|string',
            'fieldB' => 'nullable|string',
            'fieldC' => 'nullable|string',
            'fieldD' => 'nullable|string',
            'fieldE' => 'nullable|string',
        ]);

        // Simulate bill fetch (replace with actual logic)
        return response()->json([
            'status' => 'success',
            'message' => 'Bill fetched successfully',
            'data' => [
                'biller' => $data['biller'],
                'amount' => rand(100, 999), // fake amount
                'dueDate' => now()->addDays(10)->toDateString()
            ]
        ]);
    }

    

    
    
}
